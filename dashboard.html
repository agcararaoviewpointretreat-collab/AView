<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="lowo.png"> 

    <title>AVR Dashboard</title>
    
    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
      // Initialize EmailJS
      (function(){
        try {
          emailjs.init("Rpyi9nQE1VT9z90Sj");
          console.log("EmailJS initialized successfully");
        } catch (error) {
          console.error("EmailJS initialization failed:", error);
        }
      })();

function sendBookingEmail(booking, status, type = "room") {
  const templateId = status === "confirmed" ? "template_qi6nr6r" : "template_8avm8qk";
  
  const formatCurrency = (amount) => {
    if (amount === null || amount === undefined || amount === "") return "N/A";
    const numAmount = parseFloat(amount);
    return isNaN(numAmount) || numAmount === 0
      ? "N/A"
      : new Intl.NumberFormat("en-PH", { style: "currency", currency: "PHP" }).format(numAmount);
  };
  
  const formatDate = (d) => {
    if (!d) return "N/A";
    const dateObj = new Date(d);
    return isNaN(dateObj.getTime())
      ? "N/A"
      : dateObj.toLocaleDateString("en-PH", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
  };
  
  let totalAmount = 0;
  let cottageDisplayName = "N/A"; // Track cottage name for email display
  
  // Calculate total amount based on booking type
  if (type === "room") {
    // ‚úÖ CALCULATE ROOM PRICING
    console.log("üè® ROOM PRICING CALCULATION:");
    console.log("   Raw booking object for room:");
    console.log("   - booking.roomType:", booking.roomType);
    console.log("   - booking.selectedRoom:", booking.selectedRoom);
    console.log("   - booking.numberOfRooms:", booking.numberOfRooms);
    console.log("   - booking.nights:", booking.nights);
    console.log("   - booking.totalAmount:", booking.totalAmount);
    console.log("   - booking.total:", booking.total);
    console.log("   - booking.amount:", booking.amount);
    console.log("   - booking.price:", booking.price);
    
    // Try to get from existing calculated fields first
    const existingAmount = parseFloat(
      booking.totalAmount || 
      booking.total || 
      booking.amount || 
      booking.price || 
      0
    );
    
    if (existingAmount > 0) {
      totalAmount = existingAmount;
      console.log("   Using existing total amount:", totalAmount);
    } else {
      // Calculate based on room type, number of rooms, nights, and extra pax
      const roomType = (booking.roomType || booking.selectedRoom || "").toLowerCase();
      const numberOfRooms = parseInt(booking.numberOfRooms || 1);
      const numberOfNights = parseInt(booking.nights || booking.numberOfNights || 1);
      const extraPax = parseInt(booking.extraPax || booking.extraPerson || booking.additionalPerson || 0);
      
      let roomRate = 0;
      let maxRoomsForType = 1; // Default max rooms
      
      console.log("   Room details:");
      console.log("   - Room type:", roomType);
      console.log("   - Number of rooms:", numberOfRooms);
      console.log("   - Number of nights:", numberOfNights);
      console.log("   - Extra pax:", extraPax);
      
      // ‚úÖ ACTUAL ROOM RATES
      if (roomType.includes("casa de amor") || roomType.includes("amor")) {
        roomRate = 1500;
        maxRoomsForType = 3; // Casa de Amor has 3 rooms available
        console.log("   Casa de Amor selected: ‚Ç±1,500 per night");
      } else if (roomType.includes("casa de bella") || roomType.includes("bella")) {
        roomRate = 3000;
        maxRoomsForType = 1; // Only 1 Casa de Bella
        console.log("   Casa de Bella selected: ‚Ç±3,000 per night");
      } else if (roomType.includes("casa de arced") || roomType.includes("arced")) {
        roomRate = 3500;
        maxRoomsForType = 1; // Only 1 Casa de Arced
        console.log("   Casa de Arced selected: ‚Ç±3,500 per night");
      } else if (roomType.includes("casa y agua") || roomType.includes("agua")) {
        roomRate = 4999;
        maxRoomsForType = 1; // Only 1 Casa y Agua
        console.log("   Casa y Agua selected: ‚Ç±4,999 per night");
      } else {
        // Default to Casa de Amor rate if room type is unclear
        roomRate = 1500;
        console.log("   Unknown room type, defaulting to Casa de Amor rate: ‚Ç±1,500");
      }
      
      // Ensure we don't book more rooms than available for the type
      const actualRooms = Math.min(numberOfRooms, maxRoomsForType);
      if (actualRooms < numberOfRooms) {
        console.log(`   ‚ö†Ô∏è  Requested ${numberOfRooms} rooms but only ${maxRoomsForType} available for ${roomType}`);
      }
      
      // Calculate base room cost
      const roomCost = roomRate * actualRooms * numberOfNights;
      
      // Calculate extra pax cost (‚Ç±300 per head)
      const extraPaxCost = extraPax * 300;
      
      // Total amount = room cost + extra pax cost
      totalAmount = roomCost + extraPaxCost;
      
      console.log(`   Room calculation: ${roomRate} √ó ${actualRooms} rooms √ó ${numberOfNights} nights = ‚Ç±${roomCost}`);
      if (extraPax > 0) {
        console.log(`   Extra pax: ${extraPax} √ó ‚Ç±300 = ‚Ç±${extraPaxCost}`);
      }
      console.log(`   Total amount: ‚Ç±${roomCost} + ‚Ç±${extraPaxCost} = ‚Ç±${totalAmount}`);
      
      // If calculation still results in 0, use fallback
      if (totalAmount === 0) {
        totalAmount = 1500; // Minimum Casa de Amor rate
        console.log("   Using fallback minimum rate:", totalAmount);
      }
    }
  } else if (type === "activity") {
    // Determine activity type first
    const activityType = booking.activityName || booking.activityType || "activity";
    const isSwimming = activityType.toLowerCase().includes("swimming") || 
                      activityType.toLowerCase().includes("pool") ||
                      activityType.toLowerCase().includes("swim");
    
    if (isSwimming) {
      // ‚úÖ CALCULATE SWIMMING PRICING - IMPROVED VERSION
      const cottageType = (booking.cottage || booking.selectedCottage || booking.cottageType || booking.cottageSelection || booking.choosenCottage || "").toLowerCase().trim();
      
      console.log("üèä SWIMMING PRICING CALCULATION:");
      console.log("   Raw booking object cottage fields:");
      console.log("   - booking.cottage:", booking.cottage);
      console.log("   - booking.selectedCottage:", booking.selectedCottage);
      console.log("   - booking.cottageType:", booking.cottageType);
      console.log("   - booking.cottageSelection:", booking.cottageSelection);
      console.log("   - booking.choosenCottage:", booking.choosenCottage);
      console.log("   Final cottage type (lowercase):", cottageType);
      
      // Get all possible cottage field values to check
      const allCottageFields = [
        booking.cottage,
        booking.selectedCottage, 
        booking.cottageType,
        booking.cottageSelection,
        booking.choosenCottage,
        booking.cottageNumber,
        booking.cottageChoice,
        booking.selectedCottageType,
        booking.cottageSelected
      ];
      
      console.log("   All cottage field values:", allCottageFields);
      
      // More specific matching for cottage types
      if (cottageType.includes("big cottage 4") || 
          cottageType === "big cottage" ||
          cottageType === "bigcottage4") {
        totalAmount = 500;
        cottageDisplayName = "Big Cottage 4";
        console.log("   Big Cottage 4 selected: ‚Ç±500");
      } else if (cottageType.includes("cottage 1") || 
                 cottageType === "cottage1" ||
                 cottageType === "1") {
        totalAmount = 300;
        cottageDisplayName = "Cottage 1";
        console.log(`   Cottage 1 selected: ‚Ç±300`);
      } else if (cottageType.includes("cottage 2") ||
                 cottageType === "cottage2" ||
                 cottageType === "2") {
        totalAmount = 300;
        cottageDisplayName = "Cottage 2";
        console.log(`   Cottage 2 selected: ‚Ç±300`);
      } else if (cottageType.includes("cottage 3") ||
                 cottageType === "cottage3" ||
                 cottageType === "3") {
        totalAmount = 300;
        cottageDisplayName = "Cottage 3";
        console.log(`   Cottage 3 selected: ‚Ç±300`);
      } else if (cottageType.includes("cottage 4") ||
                 cottageType === "cottage4" ||
                 cottageType === "4") {
        totalAmount = 300;
        cottageDisplayName = "Cottage 4";
        console.log(`   Cottage 4 selected: ‚Ç±300`);
      } else if (cottageType.includes("cottage") && cottageType !== "") {
        // Default to regular cottage price if cottage is mentioned but not specifically identified
        totalAmount = 300;
        // Try to extract cottage name from the original value for display
        const originalValue = booking.cottage || booking.selectedCottage || booking.cottageType || booking.cottageSelection || booking.choosenCottage || "";
        cottageDisplayName = originalValue || "Cottage";
        console.log("   Regular cottage (default): ‚Ç±300, Display name:", cottageDisplayName);
      } else {
        // Check if we can infer cottage from the total amount (‚Ç±300 = regular cottage)
        const existingAmount = parseFloat(
          booking.totalAmount || 
          booking.total || 
          booking.amount || 
          booking.price || 
          0
        );
        
        console.log("   Existing amount from booking:", existingAmount);
        
        if (existingAmount === 300) {
          // If amount is ‚Ç±300, it's likely a regular cottage
          totalAmount = 300;
          // Try to find any non-empty cottage field value
          const foundCottageValue = allCottageFields.find(field => 
            field !== null && field !== undefined && field !== "" && field !== "N/A"
          );
          
          if (foundCottageValue) {
            // Clean up the cottage name for display
            const cleanName = String(foundCottageValue).trim();
            if (cleanName.match(/^[1-4]$/)) {
              cottageDisplayName = `Cottage ${cleanName}`;
            } else if (cleanName.toLowerCase().includes("cottage")) {
              cottageDisplayName = cleanName;
            } else {
              cottageDisplayName = `Cottage ${cleanName}`;
            }
          } else {
            cottageDisplayName = "Cottage (Regular)";
          }
          console.log("   Inferred regular cottage from ‚Ç±300 amount, Display name:", cottageDisplayName);
        } else if (existingAmount === 500) {
          // If amount is ‚Ç±500, it's big cottage 4
          totalAmount = 500;
          cottageDisplayName = "Big Cottage 4";
          console.log("   Inferred Big Cottage 4 from ‚Ç±500 amount");
        } else {
          // Unknown case
          totalAmount = existingAmount;
          const foundCottageValue = allCottageFields.find(field => 
            field !== null && field !== undefined && field !== "" && field !== "N/A"
          );
          cottageDisplayName = foundCottageValue || "N/A";
          console.log("   Unknown case - Amount:", totalAmount, "Display name:", cottageDisplayName);
        }
      }
    } else {
      // ‚úÖ CALCULATE TENT PRICING
      const mainGuests = parseInt(booking.guests || booking.numberOfPerson || booking.persons || 1);
      const additionalGuests = parseInt(booking.additionalGuest || booking.additionalGuests || 0);
      const hasOwnTent = booking.hasTent === "yes" || booking.rented === false || booking.tentType === "own";
      
      console.log("üèïÔ∏è TENT PRICING CALCULATION:");
      console.log("   Main guests:", mainGuests);
      console.log("   Additional guests:", additionalGuests);
      console.log("   Has own tent:", hasOwnTent);
      
      if (hasOwnTent) {
        // Own tent: ‚Ç±400 per person + ‚Ç±300 per additional guest
        totalAmount = (mainGuests * 400) + (additionalGuests * 300);
        console.log(`   Own tent calculation: (${mainGuests} √ó ‚Ç±400) + (${additionalGuests} √ó ‚Ç±300) = ‚Ç±${totalAmount}`);
      } else {
        // Rented tent: ‚Ç±999 base + ‚Ç±300 per additional guest
        totalAmount = 999 + (additionalGuests * 300);
        console.log(`   Rented tent calculation: ‚Ç±999 + (${additionalGuests} √ó ‚Ç±300) = ‚Ç±${totalAmount}`);
      }
    }
    
    // If calculation results in 0 or seems wrong, try to get from booking object
    if (totalAmount === 0 || (totalAmount < 300 && !isSwimming)) {
      const fallbackAmount = parseFloat(
        booking.totalAmount || 
        booking.total || 
        booking.amount || 
        booking.price || 
        booking.cost || 
        0
      );
      if (fallbackAmount > 0) {
        totalAmount = fallbackAmount;
        console.log("   Using fallback amount from booking:", totalAmount);
      }
    }
  }
  
  const downPaymentRaw = totalAmount > 0 ? totalAmount * 0.3 : 0;
  const balanceRaw = totalAmount > 0 ? totalAmount * 0.7 : 0;
  
  console.log("üí∞ FINAL PAYMENT CALCULATIONS:");
  console.log("   Total Amount:", totalAmount);
  console.log("   Down Payment (30%):", downPaymentRaw);
  console.log("   Balance (70%):", balanceRaw);
  
  const statusColor = status === "confirmed" ? "#28a745" : "#dc3545";
  const isRoomType = type === "room";
  
  const templateParams = {
    to_name: `${(booking.firstName || booking.fullName || "Customer").trim()} ${(booking.lastName || "").trim()}`.trim(),
    to_email: booking.email || "",
    from_name: "Agcararao Mountain View Resort",
    bookingId: booking.bookingId || booking.id || "N/A",
    type,
    status,
    status_color: statusColor,
    totalAmount: formatCurrency(totalAmount),
    downPayment: formatCurrency(downPaymentRaw),
    balance: formatCurrency(balanceRaw),
    room_section_style: isRoomType ? "display: block;" : "display: none;",
    activity_section_style: isRoomType ? "display: none;" : "display: block;",
  };
  
  if (type === "room") {
    Object.assign(templateParams, {
      roomType: booking.roomType || booking.selectedRoom || "N/A",
      checkIn: formatDate(booking.checkInDate || booking.checkIn),
      checkOut: formatDate(booking.checkOutDate || booking.checkOut),
      numberOfRooms: booking.numberOfRooms || "N/A",
      extraPax: booking.extraPax || "",
      activityName: "", activityDate: "", cottage: "", details: "",
    });
  } else if (type === "activity") {
    const tentGuests = booking.guests || booking.numberOfPerson || booking.persons || 0;
    const additionalGuests = booking.additionalGuest || booking.additionalGuests || 0;
    const tentType = booking.hasTent === "yes" || booking.rented === false ? "Own Tent" : "Rented Tent";
    
    // Determine if this is swimming or tent camping
    const activityType = booking.activityName || booking.activityType || "activity";
    const isSwimming = activityType.toLowerCase().includes("swimming") || 
                      activityType.toLowerCase().includes("pool") ||
                      activityType.toLowerCase().includes("swim");
    
    console.log("üèä ACTIVITY TYPE DETECTION:");
    console.log("   Activity type:", activityType);
    console.log("   Is swimming:", isSwimming);
    
    // ‚úÖ Enhanced date handling - different for swimming vs tent
    let activityDate = "N/A";
    const possibleDateFields = [
      booking.activityDate, booking.date, booking.tentDate, booking.checkInDate, 
      booking.checkIn, booking.startDate, booking.selectedDate, booking.reservationDate,
      booking.bookingDate, booking.dateRange, booking.dates, booking.selectedDates
    ];
    
    const rawDate = possibleDateFields.find(field => 
      field !== null && field !== undefined && field !== ""
    );
    
    console.log("üìÖ DATE PROCESSING:");
    console.log("   Found date field:", rawDate);
    
    if (rawDate) {
      if (typeof rawDate === "string") {
        if (isSwimming) {
          // ‚úÖ Swimming: Single date only (no date range)
          if (rawDate.includes(" to ")) {
            const [start] = rawDate.split(" to ").map(s => s.trim());
            activityDate = formatDate(start);
          } else if (rawDate.includes(" - ")) {
            const [start] = rawDate.split(" - ").map(s => s.trim());
            activityDate = formatDate(start);
          } else {
            activityDate = formatDate(rawDate);
          }
        } else {
          // Tent camping: Date range
          if (rawDate.includes(" to ")) {
            const [start, end] = rawDate.split(" to ").map(s => s.trim());
            activityDate = `${formatDate(start)} - ${formatDate(end)}`;
          } else if (rawDate.includes(" - ")) {
            const [start, end] = rawDate.split(" - ").map(s => s.trim());
            activityDate = `${formatDate(start)} - ${formatDate(end)}`;
          } else {
            // Single date - add next day for tent checkout
            const startDate = new Date(rawDate);
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 1);
            activityDate = `${formatDate(startDate)} - ${formatDate(endDate)}`;
          }
        }
      } else {
        if (isSwimming) {
          // Swimming: Single date only
          activityDate = formatDate(rawDate);
        } else {
          // Tent: Add next day for checkout
          const startDate = new Date(rawDate);
          const endDate = new Date(startDate);
          endDate.setDate(startDate.getDate() + 1);
          activityDate = `${formatDate(startDate)} - ${formatDate(endDate)}`;
        }
      }
    }
    
    console.log("   Final activity date:", activityDate);
    
    // ‚úÖ Handle cottage and details based on activity type
    let cottageInfo = "N/A";
    let activityDetails = "N/A";
    
    if (isSwimming) {
      // Swimming: Use the cottage display name we determined during pricing calculation
      cottageInfo = cottageDisplayName;
      activityDetails = "N/A";
      console.log("üèä Swimming booking - Using cottage display name:", cottageInfo);
    } else {
      // Tent camping: Show N/A for cottage, show tent details
      cottageInfo = "N/A";
      activityDetails = `Persons: ${tentGuests}${additionalGuests ? `, Additional: ${additionalGuests}` : ""}, ${tentType}`;
      console.log("üèïÔ∏è Tent camping - Cottage: N/A, Details:", activityDetails);
    }
    
    Object.assign(templateParams, {
      activityName: booking.activityName || booking.activityType || "Activity",
      activityDate,
      cottage: cottageInfo,
      details: activityDetails,
      roomType: "", checkIn: "", checkOut: "", numberOfRooms: "", extraPax: "",
    });
  }
  
  console.log("üìß Final template params:", templateParams);
  
  return emailjs
    .send("service_saq5ceq", templateId, templateParams)
    .then((res) => {
      console.log("‚úÖ Email sent:", res);
      alert(type + " booking " + status + " and email sent!");
    })
    .catch((err) => {
      console.error("‚ùå Email failed:", err);
      alert("Email failed: " + JSON.stringify(err));
    });
}

  



      
    </script>
    
    <style>
        /* Smooth fade-in for dashboard after login */
        #dashboardContent {
            opacity: 0;
            transition: opacity 0.7s cubic-bezier(.4,0,.2,1);
        }
        #dashboardContent.visible {
            opacity: 1;
        }
            /* Login Modal Realistic Animated Background */
            #loginModal {
                animation: fadeInBg 1.2s;
                overflow: hidden;
            }
            #loginModal::before {
                content: '';
                position: absolute;
                top: 0; left: 0; width: 100vw; height: 100vh;
                z-index: -1;
                background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
                filter: blur(8px) brightness(0.9);
                opacity: 0.95;
                animation: gradientMove 8s ease-in-out infinite alternate;
            }
            #loginModal::after {
                content: '';
                position: absolute;
                top: 0; left: 0; width: 100vw; height: 100vh;
                z-index: -2;
                background: radial-gradient(circle at 20% 30%, #b8c6db 0%, transparent 60%),
                                        radial-gradient(circle at 80% 70%, #f5d6e3 0%, transparent 60%);
                opacity: 0.7;
                animation: blobMove 12s ease-in-out infinite alternate;
            }
            @keyframes gradientMove {
                0% { background-position: 0% 50%; }
                100% { background-position: 100% 50%; }
            }
            @keyframes blobMove {
                0% { background-position: 20% 30%, 80% 70%; }
                100% { background-position: 80% 70%, 20% 30%; }
            }
            #loginForm {
                animation: popIn 1s cubic-bezier(.68,-0.55,.27,1.55);
                box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.25);
                background: rgba(255,255,255,0.85);
                backdrop-filter: blur(8px);
                border: 1.5px solid rgba(255,255,255,0.25);
            }
            @keyframes fadeInBg {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes popIn {
                0% { transform: scale(0.7) translateY(60px) rotateX(30deg); opacity: 0; }
                60% { transform: scale(1.05) translateY(-10px) rotateX(-8deg); opacity: 1; }
                100% { transform: scale(1) translateY(0) rotateX(0); opacity: 1; }
            }
        body { 
            font-family: Arial, sans-serif; 
            background: #f4f4f4; 
            text-align: center; 
            padding: 0; 
            margin: 0; 
            
        }

        /* Header Styles */
        .admin-header {
            background: linear-gradient(to right, #99e388, #aef476);
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        /* Add padding to body to account for fixed header */
        body {
            padding-top: 90px !important;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 1100px;
            width: 100%;
            padding-right: 350px;
            position: relative;
        }

        .resort-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        .resort-name {
            color: rgb(6, 5, 5);
            font-size: 22px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin: 0;
        }

        .resort-subtitle {
            color: rgb(59, 56, 56);
            font-size: 16px;
            opacity: 0.9;
            margin: 5px 0 0 0;
        }
        .header-logout {
            position: absolute;
            right: 70px;
            top: 90%;
            transform: translateY(-50%);
            z-index: 1001;
        }
        .header-logout .logout-btn {
            background: rgba(0, 0, 0, 0.1);
            color: #2c5530;
            border: 2px solid #2c5530;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .header-logout .logout-btn:hover {
            background: #2c5530;
            color: white;
        }
        .sidebar {
            width: 200px; 
            background: transparent; 
            padding: 15px; 
            border-radius: 5px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            float: left; 
            margin-right: 20px; 
            position: fixed;
            top: 120px;
        }
        .sidebar-item { position: relative; padding: 10px; margin: 5px 0; cursor: pointer; }
        .sidebar-item:hover, .sidebar-item.active { background: #e0e0e0; font-weight: bold; }
    .main-content { margin-left: 240px; padding-top: 20px; transition: margin-left 0.3s, justify-content 0.3s, display 0.3s; }
    .main-content.centered { margin-left: 0 !important; display: flex; flex-direction: column; align-items: stretch; justify-content: flex-start; width: 100vw; max-width: 100vw; }
    .main-content.centered .reservations-section { width: 100%; }
    .main-content.centered table { width: 100% !important; max-width: 100vw !important; }
        .card-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
            margin: 40px auto;
            max-width: 1200px;
            padding: 0 40px;
        }
        .card {
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            width: 90%;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .blue-card {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        .green-card {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }
        .yellow-card-activities {
            background: linear-gradient(135deg, #ffd93d, #ffc107);
        }
        .yellow-card {
            background: linear-gradient(135deg, #ff758c, #ff4d6d);
        }
        .orange-card {
            background: linear-gradient(135deg, coral, #ff7f50);
        }
        .card h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 25px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        .card-number {
            color: white;
            font-size: 72px;
            font-weight: bold;
            margin: 30px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .card-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.4);
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .card-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .section { 
            background: transparent; 
            padding: 15px; 
            border-radius: 5px; 
            margin-top: 20px; 
            
            width: 80%; 
            margin: auto; 
        }
        table { 
            width: 100%; 
            border-collapse: separate;
            border-spacing: 0;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            transition: width 0.3s;
        }
        .main-content.centered table {
            width: 100vw !important;
            max-width: 100vw !important;
        }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #ff758c; color: white; }
        button { cursor: pointer; padding: 5px 10px; border: none; border-radius: 4px; margin: 2px; }
        .confirm-btn { background: green; color: white; }
        .reject-btn { background: red; color: white; }
        .disabled-btn { background: gray; color: white; cursor: not-allowed; }
        .delete-icon { cursor: pointer; color: red; font-size: 18px; margin-left: 5px; }
        .star { color: gray; cursor: pointer; font-size: 24px; }
        .star.active { color: gold; }
        .feedback-form { 
            margin: 20px 0; 
            padding: 15px; 
            background: transparent; 
            border-radius: 5px; 
        }
        .feedback-form textarea { width: 100%; padding: 10px; margin: 10px 0; border-radius: 4px; border: 1px solid #ddd; }
        .feedback-form button { background: #4CAF50; color: white; padding: 10px 15px; }
        .ratings-chart { height: 200px; margin: 20px 0; display: flex; align-items: flex-end; justify-content: space-around; }
        .chart-bar { background: #2196F3; width: 40px; margin: 0 10px; display: flex; flex-direction: column; align-items: center; }
        .chart-label { margin-top: 5px; }
        .feedback-item { 
            background: transparent; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
        }
        .feedback-stars { color: gold; margin-bottom: 5px; }
        .feedback-text { margin: 5px 0; }
        .feedback-meta { color: #888; font-size: 12px; margin-top: 5px; }
        .announcement-card {
            background: transparent;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .announcement-form {
            margin-top: 20px;
        }
        .announcement-form input,
        .announcement-form textarea,
        .announcement-form select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        .announcement-form button {
            background: #2c5530;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        .announcement-form button:hover {
            background: #1a3a1f;
        }
        .announcement-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: left;
        }
        .announcement-item h3 {
            color: #2c5530;
            margin-bottom: 10px;
        }
        .announcement-item p {
            margin: 10px 0;
            color: #666;
        }
        .announcement-item small {
            color: #888;
            display: block;
            margin-top: 10px;
        }
        .announcement-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .edit-btn {
            background: #ffa500;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .delete-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-delete {
            background: #6c757d;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .btn-delete:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        .feedback-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        /* Feedback Section Styles */
        .feedback-section {
            padding: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            margin: 20px;
        }
        /* Stats Container */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .stat-card .value {
            color: #2c5530;
            font-size: 28px;
            font-weight: bold;
        }
        /* Filters Section */
        .feedback-filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .filter-group label {
            font-weight: 600;
            color: #2c5530;
            font-size: 14px;
        }
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            color: #333;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        select:hover {
            border-color: #2c5530;
        }
        select:focus {
            outline: none;
            border-color: #2c5530;
            box-shadow: 0 0 0 2px rgba(44, 85, 48, 0.1);
        }
        /* Feedback Grid */
        .feedback-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        /* Feedback Card */
        .feedback-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .feedback-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        /* Feedback Header */
        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .guest-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .guest-name {
            font-weight: 600;
            color: #2c5530;
            font-size: 16px;
        }
        .feedback-date {
            font-size: 12px;
            color: #666;
        }
        /* Rating Stars */
        .rating {
            color: #ffd700;
            font-size: 18px;
            letter-spacing: 2px;
        }
        /* Feedback Content */
        .feedback-content {
            color: #444;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
            min-height: 60px;
        }
        /* Feedback Actions */
        .feedback-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        /* Status Badge */
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        /* Action Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        .btn i {
            font-size: 14px;
        }
        .btn-approve {
            background: #2c5530;
            color: white;
        }
        .btn-approve:hover {
            background: #1e3c21;
            transform: translateY(-2px);
        }
        .btn-reject {
            background: #dc3545;
            color: white;
        }
        .btn-reject:hover {
            background: #bb2d3b;
            transform: translateY(-2px);
        }
        .btn-delete {
            background: #6c757d;
            color: white;
        }
        .btn-delete:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        /* Empty State */
        .empty-feedback {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .empty-feedback i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 15px;
        }
        /* Loading State */
        .loading-feedback {
            text-align: center;
            padding: 40px;
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2c5530;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Responsive Design */
        @media (max-width: 1024px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .feedback-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            .feedback-grid {
                grid-template-columns: 1fr;
            }
            .feedback-filters {
                flex-direction: column;
                align-items: stretch;
            }
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
            .filter-group label {
                margin-bottom: 5px;
            }
            .feedback-actions {
                flex-direction: column;
                gap: 8px;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .feedback-item {
            animation: fadeIn 0.3s ease-out;
        }
        /* Custom Scrollbar */
        .feedback-content::-webkit-scrollbar {
            width: 6px;
        }
        .feedback-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .feedback-content::-webkit-scrollbar-thumb {
            background: #2c5530;
            border-radius: 10px;
        }
        .feedback-content::-webkit-scrollbar-thumb:hover {
            background: #1e3c21;
        }
        .rating-stats {
            background: transparent;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .rating-overview {
            display: flex;
            gap: 30px;
        }
        .average-rating {
            text-align: center;
        }
        .big-rating {
            font-size: 48px;
            font-weight: bold;
            color: #2c5530;
        }
        .rating-bars {
            flex-grow: 1;
        }
        .rating-bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .rating-bar {
            flex-grow: 1;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            background: #ffd700;
            transition: width 0.3s ease;
        }
        .rating-label {
            width: 30px;
            text-align: right;
        }
        .rating-count {
            width: 40px;
            text-align: left;
            color: #666;
        }
        /* Notification Dot Styles */
        .notification-dot {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background-color: #ff0000;
            border-radius: 50%;
            display: none;
            animation: pulse 1.5s infinite;
        }
        .notification-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ff4444;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
            min-width: 15px;
            text-align: center;
            display: none;
        }
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 6px rgba(255, 0, 0, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(255, 0, 0, 0);
            }
        }
        /* Update sidebar item style to handle notifications */
        .sidebar-item {
            position: relative;
            padding-right: 25px; /* Add space for the notification dot */
        }
        .card-notification {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            color: #ff4444;
            font-weight: bold;
        }
        /* Add hover effect for notification dots */
        .notification-count:hover {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }
        /* Reservation section background fix */
        .reservations-section {
            background: transparent !important;
            border-radius: 16px;
            padding: 32px 24px 24px 24px;
            margin-top: 32px;
            margin-bottom: 32px;
        }
        .reservations-section h2 {
            background: transparent !important;
            margin-top: 0;
            margin-bottom: 0;
            padding-top: 24px;
            padding-bottom: 16px;
            border-radius: 16px 16px 0 0;
        }
        #bookingsTable {
            font-size: 13px;
            width: 120%;
            border-collapse: collapse;
            background: transparent !important;
            border-radius: 0 0 12px 12px;
            box-shadow: none;
        }
        /* Announcement Grid Styling */
        .announcement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .announcement-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: left;
        }

        .announcement-item h3 {
            color: #2c5530;
            margin-bottom: 10px;
        }

        .announcement-item p {
            margin: 10px 0;
            color: #666;
        }

        .announcement-item small {
            color: #888;
            display: block;
            margin-top: 10px;
        }

        .announcement-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .edit-btn {
            background: #ffa500;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .delete-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .reservations-filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: bold;
            color: #2c5530;
        }

        #statusFilter, #searchBar {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        #searchBar {
            width: 200px;
        }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .gallery-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            aspect-ratio: 16/9;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .gallery-item:hover img {
            transform: scale(1.05);
        }
        
        .gallery-item .delete-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .gallery-item:hover .delete-overlay {
            opacity: 1;
        }
        
        .gallery-item .delete-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .selected-file {
            background: #f0f0f0;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 14px;
        }

        .upload-section {
            background: transparent;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .upload-section h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: inline-block;
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .file-input-label:hover {
            background-color: #0056b3;
        }

        .upload-btn {
            padding: 12px 24px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            align-self: flex-start;
        }

        .upload-btn:hover {
            background-color: #218838;
        }

        .upload-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .preview-section {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .preview-item {
            position: relative;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .preview-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Gallery Management Section */
        .gallery-management {
            background: transparent;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .gallery-management h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .gallery-card {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background: white;
        }

        .gallery-card:hover {
            transform: translateY(-5px);
        }

        .gallery-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .gallery-card-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .gallery-card:hover .gallery-card-actions {
            opacity: 1;
        }

        .gallery-card-actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s;
        }

        .delete-btn {
            background-color: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background-color: #c82333;
        }

        .view-btn {
            background-color: #17a2b8;
            color: white;
        }

        .view-btn:hover {
            background-color: #138496;
        }

        .upload-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .upload-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .upload-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .selected-files {
            margin-top: 10px;
            color: #666;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .file-size-warning {
            color: #ff9800;
            font-size: 14px;
            margin-top: 5px;
        }

        .compression-info {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        /* Enhanced Reservation Section Styles */
        .reservations-section {
            margin: 10px 0;
        }

        .reservations-section h2 {
            padding: 10px;
            margin: 0;
        }

        .reservations-filters {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #bookingsTable {
            width: 120%;
            border-collapse: collapse;
           

        }

        #bookingsTable th {
            font-size: 13px;
            background: #ff758c;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: normal;
        }

        #bookingsTable td {
            font-size: 13px;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        #bookingsTable tr:hover {
            background-color: #f9f9f9;
        }

        #statusFilter, #searchBar {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        #searchBar {
            width: 250px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            color: #333;
            font-weight: normal;
        }

        /* Add new styles for log section */
        .log-section {
            display: none;
            padding: 20px;
        }

        .log-entry {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 14px;
            color: #333;
        }

        .log-entry .timestamp {
            color: #666;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .log-entry .action {
            font-weight: bold;
        }

        .logout-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: #ff758c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .logout-btn:hover {
            background: #ff4d6d;
        }

        /* Add new styles for activities section */
        /* Mobile view for sidebar toggle and dashboard layout */
        @media (max-width: 900px) {
            .sidebar-toggle-btn {
                top: 90px;
                left: 0;
                font-size: 16px;
                padding: 6px 8px 6px 6px;
                border-radius: 0 14px 14px 0;
            }
        }
        @media (max-width: 600px) {
            body, .section, .feedback-section, .announcement-section, .gallery-section, .activities-section, .reservations-section {
                font-size: 13px;
            }
            h1, h2, h3, h4, h5 {
                font-size: 1.1em !important;
            }
            table, th, td {
                font-size: 12px !important;
                padding: 6px !important;
            }
            input, select, textarea, button {
                font-size: 12px !important;
                padding: 6px 8px !important;
            }
            .stat-card .value, .card-number {
                font-size: 22px !important;
            }
            .feedback-content, .feedback-text, .announcement-item p, .gallery-card .image-description {
                font-size: 12px !important;
            }
            .announcement-form input, .announcement-form textarea, .announcement-form select, .announcement-form button {
                font-size: 12px !important;
                padding: 6px 8px !important;
            }
            .announcement-item h3 {
                font-size: 1em !important;
            }
            .gallery-card .image-title {
                font-size: 13px !important;
            }
            .gallery-card .upload-date {
                font-size: 11px !important;
            }
            .feedback-form textarea, .feedback-form input, .feedback-form button {
                font-size: 12px !important;
                padding: 6px 8px !important;
            }
            .btn, .card-button, .edit-btn, .delete-btn, .upload-btn, .logout-btn {
                font-size: 12px !important;
                padding: 6px 10px !important;
            }
            .stat-card h3 {
                font-size: 12px !important;
            }
            .star, .rating {
                font-size: 16px !important;
            }
            .sidebar-item {
                font-size: 12px !important;
                padding: 6px 4px !important;
            }
            .resort-logo {
                width: 36px !important;
                height: 36px !important;
            }
            .header-logout .logout-btn {
                font-size: 12px !important;
                padding: 6px 10px !important;
            }
            .card {
                min-width: 0 !important;
            }
            .card-container {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 4px !important;
                padding: -1px 2px !important;
                justify-items: stretch;
            }
            .card {
                width: 100% !important;
                max-width: none !important;
                margin: 4px 0 !important;
            }
            .card {
                padding: 2px !important;
                border-radius: 4px !important;
                width: 88vw !important;
                max-width: 100px !important;
                min-width: 0 !important;
                margin: 6px auto !important;
                font-size: 11px !important;
                box-shadow: 0 1.5px 6px rgba(44,85,48,0.08);
            }
            .card h2 {
                font-size: 12px !important;
                margin-bottom: 6px !important;
            }
            .card-number {
                font-size: 18px !important;
                margin: 6px 0 !important;
            }
            .card-button {
                font-size: 10px !important;
                padding: 4px 8px !important;
                border-radius: 3px !important;
            }
            .card h2 {
                font-size: 15px;
                margin-bottom: 10px;
            }
            .card-number {
                font-size: 32px;
                margin: 10px 0;
            }
            .card-button {
                font-size: 12px;
                padding: 6px 12px;
                border-radius: 5px;
            }
            .sidebar-toggle-btn {
                top: 60px;
                left: 0;
                font-size: 14px;
                padding: 4px 6px 4px 4px;
                border-radius: 0 10px 10px 0;
                box-shadow: 0 2px 8px rgba(44,85,48,0.13);
            }
            .sidebar {
                position: fixed !important;
                top: 50px;
                left: 0;
                width: 70vw !important;
                max-width: 220px !important;
                min-width: 140px !important;
                min-height: 100vh;
                background: #fff;
                box-shadow: 2px 0 8px rgba(44,85,48,0.18);
                z-index: 3000;
                transition: transform 0.3s;
                transform: translateX(-100%);
            }
            body.sidebar-open .sidebar {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0 !important;
                padding: 10px 2vw 0 2vw;
                transition: filter 0.3s;
            }
            body.sidebar-open .main-content {
                filter: blur(2px) brightness(0.95);
            }
            .sidebar-toggle-btn {
                z-index: 3100;
            }
            .admin-header {
                flex-direction: row;
                gap: 8px;
                padding: 8px 2vw;
            }
            .header-content {
                padding-right: 0;
                flex-direction: row;
                gap: 6px;
            }
            .resort-logo {
                width: 48px;
                height: 48px;
            }
            .resort-name {
                font-size: 15px;
            }
            .resort-subtitle {
                font-size: 12px;
            }
        }
        .activities-section {
            margin: 10px 0;
        }

        .activities-filters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 5px;
        }

        #activitiesTable {
            font-size: 13px;
            width: 125%;
            border-collapse: collapse;
            border-radius: 0 0 12px 12px;
            margin-top: 0;
        }

        #activitiesTable th {
            font-size: 13px;
            background: #ff758c;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: normal;
        }

        #activitiesTable td {
            font-size: 13px;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        #activitiesTable tr:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .image-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .image-details input,
        .image-details textarea {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
        }

        .image-details textarea {
            resize: vertical;
            min-height: 80px;
        }

        .preview-item {
            position: relative;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background: white;
            padding-bottom: 10px;
        }

        .preview-item .image-info {
            padding: 8px;
        }

        .preview-item .image-info input {
            width: calc(100% - 16px);
            margin-bottom: 8px;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .preview-item .image-info textarea {
            width: calc(100% - 16px);
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 60px;
        }

        /* Add these new styles */
        .gallery-filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .gallery-filters .filter-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .gallery-filters label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .gallery-filters select,
        .gallery-filters input {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .gallery-filters select:focus,
        .gallery-filters input:focus {
            border-color: #ff758c;
            box-shadow: 0 0 0 2px rgba(255, 117, 140, 0.1);
            outline: none;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            padding: 20px 0;
        }

        .gallery-card {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }

        .gallery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .gallery-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .gallery-card .image-info {
            padding: 15px;
        }

        .gallery-card .image-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .gallery-card .image-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .gallery-card .upload-date {
            color: #888;
            font-size: 12px;
            margin-top: 5px;
        }

        .gallery-card .gallery-card-actions {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .gallery-card .gallery-card-actions button {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .gallery-card .view-btn {
            background: #2196F3;
            color: white;
        }

        .gallery-card .delete-btn {
            background: #f44336;
            color: white;
        }

        .gallery-card .view-btn:hover,
        .gallery-card .delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
         /* Sidebar toggle button */
        .sidebar-toggle-btn {
            position: fixed;
            top: 130px;
            left: 0;
            z-index: 2001;
            background: linear-gradient(135deg, #2c5530 60%, #99e388 100%);
            color: #fff;
            border: none;
            border-radius: 0 18px 18px 10;
            padding: 10px 8px 12px 2px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 18px rgba(44,85,48,0.18), 0 1.5px 4px rgba(44,85,48,0.10);
            transition: left 0.3s, background 0.2s, box-shadow 0.2s, color 0.2s, border-radius 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Segoe UI', Arial, sans-serif;
            letter-spacing: 1px;
        }
        .sidebar-toggle-btn .toggle-icon {
            display: inline-block;
            font-size: 1em;
            transition: transform 0.3s;
        }
        .sidebar-hidden .sidebar-toggle-btn .toggle-icon {
            transform: rotate(180deg);
        }
        .sidebar-toggle-btn .toggle-label {
            font-size: 1em;
            font-weight: 500;
            color: #e6ffe6;
            letter-spacing: 0.5px;
            transition: color 0.2s;
        }
        .sidebar-toggle-btn:hover, .sidebar-toggle-btn:focus {
            background: linear-gradient(135deg, #99e388 60%, #2c5530 100%);
            color: #2c5530;
            box-shadow: 0 6px 24px rgba(44,85,48,0.22), 0 2px 8px rgba(44,85,48,0.13);
            outline: none;
        }
        .sidebar-toggle-btn:active {
            background: #2c5530;
            color: #fff;
        }
        .sidebar-hidden .sidebar {
            left: -220px !important;
            transition: left 0.3s;
        }
        .sidebar {
            transition: left 0.3s;
        }
        .sidebar-hidden .main-content {
            margin-left: 40px !important;
            transition: margin-left 0.3s;
        }
        @media (max-width: 900px) {
            .sidebar {
                width: 160px !important;
            }
            .sidebar-toggle-btn {
                top: 100px;
                font-size: 18px;
                padding: 8px 10px;
            }
        }
        @media (max-width: 600px) {
            .sidebar {
                width: 120px !important;
                padding: 8px !important;
                font-size: 13px !important;
            }
            .sidebar-toggle-btn {
                top: 80px;
                font-size: 16px;
                padding: 6px 8px;
            }
        }
         /* Bubbles animation for login background */
        .bubbles-bg {
            position: absolute;
            top: 0; left: 0; width: 100vw; height: 100vh;
            z-index: 1;
            overflow: hidden;
            pointer-events: none;
        }
        .bubble {
            position: absolute;
            bottom: -120px;
            border-radius: 50%;
            opacity: 0.45;
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            animation: bubbleUp 8s linear infinite;
            filter: blur(1.5px);
        }
        @keyframes bubbleUp {
            0% { transform: translateY(0) scale(1); opacity: 0.5; }
            80% { opacity: 0.7; }
            100% { transform: translateY(-110vh) scale(1.15); opacity: 0; }
        }
    </style>
</head>
<body>
        <div id="loginModal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;z-index:2000;overflow:hidden;">
            <div class="bubbles-bg"></div>
            <form id="loginForm" style="background:#fff;padding:48px 36px;border-radius:18px;box-shadow:0 8px 32px rgba(0,0,0,0.18);min-width:400px;max-width:480px;display:flex;flex-direction:column;gap:28px;align-items:center;position:relative;z-index:2;">
                <h2 style="color:#2c5530;margin-bottom:8px;">Login</h2>
                <input type="text" id="loginUser" placeholder="Username" style="padding:10px;width:100%;border-radius:6px;border:1px solid #ccc;" required>
                <input type="password" id="loginPass" placeholder="Password" style="padding:10px;width:100%;border-radius:6px;border:1px solid #ccc;" required>
                <button type="submit" style="background:#2c5530;color:#fff;padding:10px 0;width:100%;border:none;border-radius:6px;font-size:1rem;cursor:pointer;">Log In</button>
                <div id="loginError" style="color:#c00;font-size:0.95rem;display:none;">Invalid credentials</div>
            </form>
        </div>
       

    <div id="dashboardContent" style="display:none;">
    <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="Show/Hide Menu">
        <span class="toggle-icon">&#9776;</span>
    </button>
    <!-- Add header section -->
    <header class="admin-header">
        <div class="header-content">
            <img src="loho.png" alt="Resort Logo" class="resort-logo">
            <div>
                <h1 class="resort-name">Agcararao Viewpoint Retreat</h1>
                <p class="resort-subtitle">Admin Dashboard</p>
            </div>
        </div>
        <div class="header-logout">
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
        </div>
    </header>

    <div class="sidebar" id="sidebar">
    <!-- Sidebar content -->
        <div class="sidebar-item active" data-section="dashboard">Dashboard</div>
        <div class="sidebar-item" data-section="reservations">
            Reservations
            <span id="reservationDot" class="notification-dot"></span>
            <span id="reservationCount" class="notification-count">0</span>
        </div>
        <div class="sidebar-item" data-section="activities">
            Activities
            <span id="activitiesDot" class="notification-dot"></span>
            <span id="activitiesCount" class="notification-count">0</span>
        </div>
        <div class="sidebar-item" data-section="ratings">
            Ratings & Feedback
            <span id="feedbackDot" class="notification-dot"></span>
            <span id="feedbackCount" class="notification-count">0</span>
        </div>
        <div class="sidebar-item" data-section="announcements">Announcements & Updates</div>
        <div class="sidebar-item" data-section="gallery">Gallery</div>
    </div>

    <div class="main-content">
        <div class="dashboard-section">
            <div class="card-container">
                <div class="card blue-card">
                    <h2>Reservations</h2>
                    <div class="card-number" id="reservationsCount">0</div>
                    <button class="card-button" data-section="reservations">Manage</button>
                </div>
                <div class="card yellow-card-activities">
                    <h2>Activities</h2>
                    <div class="card-number" id="activitiesCardCount">0</div>
                    <button class="card-button" data-section="activities">Manage</button>
                </div>
                <div class="card green-card">
                    <h2>Average Rating</h2>
                    <div class="card-number" id="avgRating">0.0</div>
                    <button class="card-button" data-section="ratings">View All</button>
                </div>
                <div class="card yellow-card">
                    <h2>Announcements</h2>
                    <div class="card-number" id="announcementsCount">0</div>
                    <button class="card-button" data-section="announcements">Manage</button>
                </div>
                 <div class="card orange-card">
                    <h2>Gallery Management</h2>
                    <div class="card-number" id="galleryCount">0</div>
                    <button class="card-button" data-section="gallery">Manage</button>
                </div>
              
            </div>
        </div>

        <div class="reservations-section section" style="display: none;">
            <h2>Reservations</h2>

            <!-- Filters and Search Bar -->
            <div class="reservations-filters">
                <div class="filter-group">
                    <label for="monthFilter">Filter by Month:</label>
                    <select id="monthFilter" onchange="filterByMonth()">
                        <option value="all">All Months</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="statusFilter">Filter by Status:</label>
                    <select id="statusFilter">
                        <option value="all">All</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchBar">Search:</label>
                    <input type="text" id="searchBar" placeholder="Search by name or email">
                </div>
            </div>

            <table id="bookingsTable">
                <tr>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>Room</th>
                    <th>No. of Rooms</th>
                    <th>Extra Pax</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                    <th>No. of Nights</th>
                    <th>Total Amount</th>
                    <th>Down Payment</th>
                    <th>Balance</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </table>
        </div>

        <div class="ratings-section section" style="display: none;">
            <h2>Ratings & Feedback</h2>
            
            <div class="feedback-section">
                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total Feedback</h3>
                        <div class="value" id="totalFeedback">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pending Review</h3>
                        <div class="value" id="pendingFeedback">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Average Rating</h3>
                        <div class="value" id="averageRating">0.0 ‚òÖ</div>
                    </div>
                </div>

                <div class="feedback-filters">
                    <div class="filter-group">
                        <label>Filter by Status:</label>
                        <select id="status-filter" onchange="filterFeedback()">
                            <option value="all">All Feedback</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Sort by:</label>
                        <select id="sort-filter" onchange="sortFeedback()">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="rating-high">Highest Rating</option>
                            <option value="rating-low">Lowest Rating</option>
                        </select>
                    </div>
                </div>

                <div id="feedbackList" class="feedback-grid">
                    <!-- Feedback cards will be dynamically inserted here -->
                </div>
            </div>
            
            <div class="feedback-form">
                <h3>Submit Feedback (Admin Test)</h3>
                <div>
                    <span class="star" data-rating="1">‚òÖ</span>
                    <span class="star" data-rating="2">‚òÖ</span>
                    <span class="star" data-rating="3">‚òÖ</span>
                    <span class="star" data-rating="4">‚òÖ</span>
                    <span class="star" data-rating="5">‚òÖ</span>
                </div>
                <textarea id="feedbackText" placeholder="Your feedback..." rows="4"></textarea>
                <input type="text" id="guestName" placeholder="Guest Name" style="padding: 10px; margin: 10px 0; width: 100%;">
                <button id="submitFeedback">Submit Feedback</button>
            </div>
        </div>

        <div class="announcements-section section" style="display: none;">
            <h2>Announcements & Updates</h2>

            <!-- Announcement Form -->
            <div class="announcement-form">
                <h4>Add New Announcement</h4>
                <form id="announcementForm">
                    <input type="text" id="title" placeholder="Title" required>
                    <textarea id="content" placeholder="Content" required></textarea>
                    <select id="category" required>
                        <option value="special-offers">Special Offers</option>
                        <option value="new-activities">New Activities</option>
                        <option value="events">Events</option>
                    </select>
                    <button type="submit" id="submitBtn">Post Announcement</button>
                </form>
            </div>

            <!-- Announcement List -->
            <div id="announcementsList" class="announcement-grid">
                <p>Loading announcements...</p>
            </div>
        </div>

        <div class="gallery-section section" style="display: none;">
            <h2>Gallery Management</h2>

            <!-- Add Gallery Filters -->
            <div class="gallery-filters">
                <div class="filter-group">
                    <label for="galleryMonthFilter">Filter by Month:</label>
                    <select id="galleryMonthFilter" onchange="filterGalleryByMonth()">
                        <option value="all">All Time</option>
                        <option value="current">Current Month</option>
                        <option value="last">Last Month</option>
                        <option value="older">Older</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="gallerySearch">Search:</label>
                    <input type="text" id="gallerySearch" placeholder="Search by title or description" oninput="filterGalleryBySearch()">
                </div>
            </div>

            <!-- Admin Panel Section -->
            <div class="admin-container" id="adminContainer">
                <!-- Remove the duplicate header -->

                <!-- Upload Section -->
                <div class="upload-section">
                    <h2>Upload New Images</h2>
                    <form class="upload-form" id="uploadForm">
                        <div class="file-input-wrapper">
                            <label for="imageUpload" class="file-input-label">Choose Images</label>
                            <input type="file" id="imageUpload" accept="image/*" multiple>
                        </div>
                        <div class="selected-files" id="selectedFiles"></div>
                        <div class="compression-info">Images will be compressed to ensure optimal loading times.</div>
                        <div class="preview-section" id="previewSection"></div>
                        <button type="submit" class="upload-btn" id="uploadBtn" disabled>Upload Images</button>
                        <div class="upload-status" id="uploadStatus"></div>
                    </form>
                </div>

                <!-- Gallery Management Section -->
                <div class="gallery-management">
                    <h2>Manage Gallery</h2>
                    <div class="gallery-grid" id="galleryGrid">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading images...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="activities-section section" style="display: none;">
            <h2>Activities Reservations</h2>

            <!-- Filters and Search Bar -->
            <div class="activities-filters">
                <div class="filter-group">
                    <label for="activityMonthFilter">Filter by Month:</label>
                    <select id="activityMonthFilter" onchange="filterActivitiesByMonth()">
                        <option value="all">All Months</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="activityFilter">Filter by Activity:</label>
                    <select id="activityFilter">
                        <option value="all">All Activities</option>
                        <option value="swimming">Swimming Pool</option>
                        <option value="tent">Tent Camping</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="activityStatusFilter">Filter by Status:</label>
                    <select id="activityStatusFilter">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="activitySearchBar">Search:</label>
                    <input type="text" id="activitySearchBar" placeholder="Search by name or email">
                </div>
            </div>

            <table id="activitiesTable">
                <tr>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>Activity Type</th>
                    <th>Date</th>
                    <th>Details</th>
                    <th>Total Amount</th>
                    <th>Down Payment<br><span style="font-weight:normal;font-size:12px;">Paid?</span></th>
                    <th>Balance</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </table>
        </div>

    </div>

    <script type="module">
    // Enhance Down Payment column: add checkbox for admin to mark as paid
    function enhanceDownPaymentCheckbox() {
        const table = document.getElementById('bookingsTable');
        if (!table) return;
        // For each row except header
        Array.from(table.rows).slice(1).forEach(row => {
            // Down Payment is the 11th cell (index 10)
            const dpCell = row.cells[10];
            if (dpCell && !dpCell.querySelector('.dp-paid-checkbox')) {
                const value = dpCell.textContent;
                dpCell.textContent = '';
                const span = document.createElement('span');
                span.textContent = value + ' ';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'dp-paid-checkbox';
                checkbox.title = 'Mark as paid';
                dpCell.appendChild(span);
                dpCell.appendChild(checkbox);
            }
        });
    }
    // Run after DOM and table are loaded
    document.addEventListener('DOMContentLoaded', enhanceDownPaymentCheckbox);
    // Also run after any table update (if you have dynamic updates, call this again)
    // Filter activities table by activity date month
    window.filterActivitiesByMonth = function() {
        const month = document.getElementById('activityMonthFilter').value;
        const table = document.getElementById('activitiesTable');
        if (!table) return;
        const rows = Array.from(table.rows).slice(1); // skip header
        rows.forEach(row => {
            const dateCell = row.cells[4]; // 5th column: Date
            if (!dateCell) return row.style.display = '';
            if (month === 'all') {
                row.style.display = '';
            } else {
                // Try to parse month from date string
                const dateStr = dateCell.textContent.trim();
                const date = new Date(dateStr);
                if (!isNaN(date.getTime()) && (date.getMonth() + 1).toString() === month) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        });
    }
    // Filter reservation table by check-in month
    window.filterByMonth = function() {
        const month = document.getElementById('monthFilter').value;
        const table = document.getElementById('bookingsTable');
        if (!table) return;
        const rows = Array.from(table.rows).slice(1); // skip header
        rows.forEach(row => {
            const checkInCell = row.cells[6]; // 7th column: Check-in
            if (!checkInCell) return row.style.display = '';
            if (month === 'all') {
                row.style.display = '';
            } else {
                // Try to parse month from date string
                const dateStr = checkInCell.textContent.trim();
                const date = new Date(dateStr);
                if (!isNaN(date.getTime()) && (date.getMonth() + 1).toString() === month) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        });
    }
    // Sidebar toggle logic
    document.addEventListener('DOMContentLoaded', function() {
        var sidebar = document.getElementById('sidebar');
        var toggleBtn = document.getElementById('sidebarToggleBtn');
        var mainContent = document.querySelector('.main-content');
        if (sidebar && toggleBtn && mainContent) {
            toggleBtn.addEventListener('click', function() {
                if (sidebar.style.display === 'none') {
                    sidebar.style.display = '';
                    mainContent.classList.remove('centered');
                } else {
                    sidebar.style.display = 'none';
                    mainContent.classList.add('centered');
                }
            });
        }
    });
        // Sidebar toggle logic (mobile overlay)
        (function(){
            var btn = document.getElementById('sidebarToggleBtn');
            function toggleSidebar() {
                document.body.classList.toggle('sidebar-open');
            }
            btn && btn.addEventListener('click', toggleSidebar);
            // Optional: close sidebar when clicking outside (mobile only)
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 600) {
                    var sidebar = document.querySelector('.sidebar');
                    if (
                        document.body.classList.contains('sidebar-open') &&
                        !sidebar.contains(e.target) &&
                        e.target !== btn &&
                        !btn.contains(e.target)
                    ) {
                        document.body.classList.remove('sidebar-open');
                    }
                }
            });
        })();
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, get, onValue, update, remove, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
    
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBAE0ieuAJRp_rF4I90qXP8zPr4TQW_rIg",
            authDomain: "agcararaoret.firebaseapp.com",
            databaseURL: "https://agcararaoret-default-rtdb.firebaseio.com",
            projectId: "agcararaoret",
            storageBucket: "agcararaoret.appspot.com",
            messagingSenderId: "369964400118",
            appId: "1:369964400118:web:bd0e0f15ef0e235392dbd7"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const imagesRef = ref(db, 'gallery/images');
    
        // Load initial data immediately
        onValue(ref(db, 'bookings'), (snapshot) => {
            let totalBookings = 0;
            snapshot.forEach(() => {
                totalBookings++;
            });
            document.getElementById('reservationsCount').textContent = totalBookings;
        });

        onValue(ref(db, 'feedback'), (snapshot) => {
            let totalRating = 0;
            let approvedCount = 0;
            snapshot.forEach((child) => {
                const feedback = child.val();
                if (feedback.isApproved) {
                    totalRating += feedback.rating;
                    approvedCount++;
                }
            });
            const average = approvedCount > 0 ? (totalRating / approvedCount).toFixed(1) : '0.0';
            document.getElementById('avgRating').innerHTML = `${average} <span style="font-size: 16px; color: #ffeb3b;">‚òÖ</span>`;
        });

        let unavailableDates = [];

        async function fetchBookedDates() {
            try {
                const bookingsRef = ref(db, "bookings");
                onValue(bookingsRef, (snapshot) => {
                    if (snapshot.exists()) {
                        unavailableDates = [];
                        const selectedRoom = document.getElementById("selectedRoom").value;
                        const numberOfRooms = parseInt(document.getElementById("numberOfRooms").value) || 1;
                        
                        // Create a map to track room bookings per date
                        const roomBookingsPerDate = new Map();
                        
                        snapshot.forEach((childSnapshot) => {
                            const booking = childSnapshot.val();
                            if (booking.selectedRoom === selectedRoom) {
                                let currentDate = new Date(booking.checkInDate);
                                const checkOutDate = new Date(booking.checkOutDate);
                                const roomsBooked = parseInt(booking.numberOfRooms) || 1;

                                while (currentDate <= checkOutDate) {
                                    const dateStr = currentDate.toISOString().split("T")[0];
                                    const currentBookings = roomBookingsPerDate.get(dateStr) || 0;
                                    roomBookingsPerDate.set(dateStr, currentBookings + roomsBooked);
                                    currentDate.setDate(currentDate.getDate() + 1);
                                }
                            }
                        });

                        // For Casa De Amon, check if the requested number of rooms is available
                        if (selectedRoom === "Casa De Amor") {
                            roomBookingsPerDate.forEach((bookedRooms, date) => {
                                if (bookedRooms + numberOfRooms > 3) {
                                    unavailableDates.push(date);
                                }
                            });
                        } else {
                            // For other rooms, mark dates as unavailable if any booking exists
                            roomBookingsPerDate.forEach((_, date) => {
                                unavailableDates.push(date);
                            });
                        }
                    }
                    initDatePicker();
                });
            } catch (error) {
                console.error("Error fetching booked dates:", error);
            }
        }

        window.confirmBooking = async function(id) {
            try {
                // First get the booking data to send email
                const bookingRef = ref(db, `bookings/${id}`);
                const bookingSnapshot = await get(bookingRef);
                const bookingData = bookingSnapshot.val();
                
                // Update the booking status
                await update(ref(db, `bookings/${id}`), {
                    status: "approved",
                    approvedDate: new Date().toISOString()
                });
                addLogEntry('Booking Confirmed', `Booking ID: ${id}`);
                
                // Send confirmation email
                try {
                    await sendBookingEmail(bookingData, "confirmed", "room");
                } catch (emailError) {
                    console.error("Email failed but booking was confirmed:", emailError);
                    alert("Booking confirmed successfully! (Email notification failed)");
                }
                
                // Check if there are any remaining pending bookings
                const bookingsRef = ref(db, 'bookings');
                const snapshot = await get(bookingsRef);
                let hasPending = false;
                snapshot.forEach((child) => {
                    const booking = child.val();
                    if (booking.status === 'pending') {
                        hasPending = true;
                    }
                });
                
                // Only hide notification if no pending bookings remain
                if (!hasPending) {
                    const reservationDot = document.getElementById('reservationDot');
                    const reservationCount = document.getElementById('reservationCount');
                    if (reservationDot) reservationDot.style.display = 'none';
                    if (reservationCount) reservationCount.style.display = 'none';
                }
                
                loadBookings();
            } catch (error) {
                console.error("Error confirming booking:", error);
                alert("Failed to confirm booking. Please try again.");
            }
        };

        window.rejectBooking = async function(id) {
            try {
                // First get the booking data to send email
                const bookingRef = ref(db, `bookings/${id}`);
                const bookingSnapshot = await get(bookingRef);
                const bookingData = bookingSnapshot.val();
                
                // Update the booking status
                await update(ref(db, `bookings/${id}`), {
                    status: "rejected",
                    rejectedDate: new Date().toISOString()
                });
                addLogEntry('Booking Rejected', `Booking ID: ${id}`);
                
                // Send rejection email
                try {
                    await sendBookingEmail(bookingData, "rejected", "room");
                } catch (emailError) {
                    console.error("Email failed but booking was rejected:", emailError);
                    alert("Booking rejected successfully! (Email notification failed)");
                }
                
                loadBookings();
            } catch (error) {
                console.error("Error rejecting booking:", error);
                alert("Failed to reject booking. Please try again.");
            }
        };

        window.deleteBooking = async function(id) {
            if (confirm("Are you sure you want to delete this booking?")) {
                try {
                    await remove(ref(db, `bookings/${id}`));
                    alert("Booking deleted successfully!");
                    loadBookings();
                } catch (error) {
                    console.error("Error deleting booking:", error);
                    alert("Failed to delete booking. Please try again.");
                }
            }
        };

        // Rating selection
        let currentRating = 0;
        document.querySelectorAll('.star').forEach(star => {
            star.addEventListener('click', function() {
                currentRating = parseInt(this.dataset.rating);
                updateStars(currentRating);
            });
            
            star.addEventListener('mouseover', function() {
                const rating = parseInt(this.dataset.rating);
                hoverStars(rating);
            });
            
            star.addEventListener('mouseout', function() {
                hoverStars(0);
                updateStars(currentRating);
            });
        });
        
        function updateStars(rating) {
            document.querySelectorAll('.star').forEach(star => {
                const starRating = parseInt(star.dataset.rating);
                if (starRating <= rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }
        
        function hoverStars(rating) {
            document.querySelectorAll('.star').forEach(star => {
                const starRating = parseInt(star.dataset.rating);
                if (starRating <= rating) {
                    star.style.color = 'gold';
                } else {
                    star.style.color = 'gray';
                }
            });
        }

        // Submit feedback
        document.getElementById('submitFeedback').addEventListener('click', function() {
            const feedback = document.getElementById('feedbackText').value.trim();
            const guestName = document.getElementById('guestName').value.trim();
            
            if (currentRating === 0) {
                alert('Please select a rating');
                return;
            }
            
            if (feedback === '') {
                alert('Please enter your feedback');
                return;
            }
            
            if (guestName === '') {
                alert('Please enter a guest name');
                return;
            }
            
            const feedbackData = {
                rating: currentRating,
                feedback: feedback,
                guest: guestName,
                date: new Date().toISOString(),
                isApproved: false,
                isRejected: false
            };
            
            push(ref(db, 'feedback'), feedbackData)
                .then(() => {
                    alert('Feedback submitted successfully!');
                    document.getElementById('feedbackText').value = '';
                    document.getElementById('guestName').value = '';
                    currentRating = 0;
                    updateStars(0);
                    loadFeedback();
                })
                .catch(error => {
                    alert('Error submitting feedback: ' + error.message);
                });
        });

        // Load feedback
        function loadFeedback() {
            const feedbackRef = ref(db, 'feedback');
            onValue(feedbackRef, (snapshot) => {
                const feedbackList = document.getElementById('feedbackList');
                feedbackList.innerHTML = '';

                let totalFeedback = 0;
                let pendingFeedback = 0;
                let totalRating = 0;
                let approvedFeedbackCount = 0;
                const feedbackArray = [];

                snapshot.forEach((child) => {
                    const feedback = child.val();
                    feedback.id = child.key;
                    feedbackArray.push(feedback);
                    
                    totalFeedback++;
                    if (!feedback.isApproved && !feedback.isRejected) {
                        pendingFeedback++;
                    }
                    
                    // Only count approved feedback for average rating
                    if (feedback.isApproved) {
                        totalRating += feedback.rating;
                        approvedFeedbackCount++;
                    }
                });

                // Calculate average rating from approved feedback only
                const averageRating = approvedFeedbackCount > 0 ? (totalRating / approvedFeedbackCount).toFixed(1) : '0.0';

                // Update statistics
                updateFeedbackStats(totalFeedback, pendingFeedback, averageRating);

                // Sort feedback array by default (newest first)
                feedbackArray.sort((a, b) => new Date(b.date) - new Date(a.date));

                // Display feedback
                displayFeedback(feedbackArray);
            });
        }
        
        function updateFeedbackStats(total, pending, avgRating) {
            // Update the statistics in the dashboard
            document.getElementById('totalFeedback').textContent = total;
            document.getElementById('pendingFeedback').textContent = pending;
            document.getElementById('averageRating').innerHTML = `${avgRating} <i class="fas fa-star" style="color: #ffd700;"></i>`;
            
            // Update the main dashboard average rating if it exists
            const mainDashboardRating = document.getElementById('avgRating');
            if (mainDashboardRating) {
                mainDashboardRating.innerHTML = `${avgRating} <i class="fas fa-star" style="color: #ffd700;"></i>`;
            }
        }

        function displayFeedback(feedbackArray) {
            const feedbackList = document.getElementById('feedbackList');
            feedbackList.innerHTML = '';

            feedbackArray.forEach(feedback => {
                const card = createFeedbackCard(feedback);
                feedbackList.appendChild(card);
            });
        }

        function createFeedbackCard(feedback) {
            const card = document.createElement('div');
            card.className = 'feedback-item';
            
            let status = 'pending';
            if (feedback.isApproved) status = 'approved';
            if (feedback.isRejected) status = 'rejected';

            card.innerHTML = `
                <div class="feedback-header">
                    <div class="guest-info">
                        <span class="guest-name">${feedback.guest}</span>
                        <span class="feedback-date">${new Date(feedback.date).toLocaleDateString()}</span>
                    </div>
                    <div class="rating">${'‚òÖ'.repeat(feedback.rating)}${'‚òÜ'.repeat(5-feedback.rating)}</div>
                </div>
                <div class="feedback-content">${feedback.feedback}</div>
                <div class="feedback-actions">
                    <span class="status-badge status-${status}">${status.toUpperCase()}</span>
                    ${status === 'pending' ? `
                        <button class="btn btn-approve" onclick="approveFeedback('${feedback.id}')">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn btn-reject" onclick="rejectFeedback('${feedback.id}')">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    ` : ''}
                    <button class="btn btn-delete" onclick="deleteFeedback('${feedback.id}')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            
            return card;
        }

        // Feedback Action Functions
        window.approveFeedback = async function(feedbackId) {
            try {
                await update(ref(db, `feedback/${feedbackId}`), {
                    isApproved: true,
                    isRejected: false,
                    approvedDate: new Date().toISOString()
                });
                
                // Check if there are any remaining pending feedback
                const feedbackRef = ref(db, 'feedback');
                const snapshot = await get(feedbackRef);
                let hasPending = false;
                snapshot.forEach((child) => {
                    const feedback = child.val();
                    if (!feedback.isApproved && !feedback.isRejected) {
                        hasPending = true;
                    }
                });
                
                // Only hide notification if no pending feedback remains
                if (!hasPending) {
                    const feedbackDot = document.getElementById('feedbackDot');
                    const feedbackCount = document.getElementById('feedbackCount');
                    if (feedbackDot) feedbackDot.style.display = 'none';
                    if (feedbackCount) feedbackCount.style.display = 'none';
                }
                
                alert("Feedback approved successfully!");
                loadFeedback();
            } catch (error) {
                console.error("Error approving feedback:", error);
                alert("Failed to approve feedback. Please try again.");
            }
        };

        window.rejectFeedback = async function(feedbackId) {
            try {
                await update(ref(db, `feedback/${feedbackId}`), {
                    isApproved: false,
                    isRejected: true,
                    rejectedDate: new Date().toISOString()
                });
                alert("Feedback rejected successfully!");
                loadFeedback();
            } catch (error) {
                console.error("Error rejecting feedback:", error);
                alert("Failed to reject feedback. Please try again.");
            }
        };

        // Feedback Filter Function
        window.filterFeedback = function() {
            const status = document.getElementById('status-filter').value;
            const cards = document.querySelectorAll('.feedback-item');
            
            cards.forEach(card => {
                const statusBadge = card.querySelector('.status-badge');
                const currentStatus = statusBadge.textContent.toLowerCase();
                
                if (status === 'all' || status === currentStatus) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        };

        // Feedback Sort Function
        window.sortFeedback = function() {
            const sortBy = document.getElementById('sort-filter').value;
            const list = document.getElementById('feedbackList');
            const cards = Array.from(list.children);
            
            cards.sort((a, b) => {
                const dateA = new Date(a.querySelector('.feedback-date').textContent);
                const dateB = new Date(b.querySelector('.feedback-date').textContent);
                const ratingA = a.querySelector('.rating').textContent.split('‚òÖ').length - 1;
                const ratingB = b.querySelector('.rating').textContent.split('‚òÖ').length - 1;
                
                switch(sortBy) {
                    case 'newest':
                        return dateB - dateA;
                    case 'oldest':
                        return dateA - dateB;
                    case 'rating-high':
                        return ratingB - ratingA;
                    case 'rating-low':
                        return ratingA - ratingB;
                    default:
                        return 0;
                }
            });
            
            list.innerHTML = '';
            cards.forEach(card => list.appendChild(card));
        };

        document.querySelectorAll('.sidebar-item, .card-button').forEach(item => {
            item.addEventListener('click', function() {
                const section = this.dataset.section;
                
                // Hide all sections
                document.querySelector('.dashboard-section').style.display = 'none';
                document.querySelector('.reservations-section').style.display = 'none';
                document.querySelector('.ratings-section').style.display = 'none';
                document.querySelector('.announcements-section').style.display = 'none';
                document.querySelector('.gallery-section').style.display = 'none';
                document.querySelector('.activities-section').style.display = 'none';
                
                // Show selected section
                document.querySelector(`.${section}-section`).style.display = 'block';
                
                // Update sidebar active state
                document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
                document.querySelector(`.sidebar-item[data-section="${section}"]`).classList.add('active');
                
                // Load section data
                if (section === 'reservations') loadBookings();
                if (section === 'ratings') loadFeedback();
                if (section === 'announcements') loadAnnouncements();
                if (section === 'gallery') loadGalleryImages();
                if (section === 'activities') loadActivities();
            });
        });

        // Add specific event listener for the orange gallery management card
        document.querySelector('.orange-card .card-button').addEventListener('click', function() {
            // Hide all sections
            document.querySelector('.dashboard-section').style.display = 'none';
            document.querySelector('.reservations-section').style.display = 'none';
            document.querySelector('.ratings-section').style.display = 'none';
            document.querySelector('.announcements-section').style.display = 'none';
            document.querySelector('.gallery-section').style.display = 'none';
            document.querySelector('.activities-section').style.display = 'none';
            
            // Show gallery section
            document.querySelector('.gallery-section').style.display = 'block';
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            document.querySelector('.sidebar-item[data-section="gallery"]').classList.add('active');
            
            // Load gallery data
            loadGalleryImages();
        });

        function loadBookings() {
            onValue(ref(db, "bookings"), (snapshot) => {
                const table = document.getElementById("bookingsTable");
                const statusFilter = document.getElementById("statusFilter").value;
                const searchQuery = document.getElementById("searchBar").value.toLowerCase();

                table.innerHTML = `
                    <tr>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>Room</th>
                        <th>No. of Rooms</th>
                        <th>Extra Pax</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>No. of Nights</th>
                        <th>Total Amount</th>
                        <th>Down Payment</th>
                        <th>Balance</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>`;

                if (!snapshot.exists()) {
                    table.innerHTML += `<tr><td colspan="13" style="text-align:center;">No bookings</td></tr>`;
                    return;
                }

                const today = new Date().toISOString().split('T')[0];
                let count = 0;
                let filteredCount = 0;
                let bookingsArray = [];

                snapshot.forEach((child) => {
                    const data = child.val();
                    data.id = child.key;
                    bookingsArray.push(data);
                });

                // Sort bookings by check-in date in descending order
                bookingsArray.sort((a, b) => new Date(b.checkInDate) - new Date(a.checkInDate));

                bookingsArray.forEach((data) => {
                    let status = data.status || "pending";
                    let pastStay = data.checkOutDate < today;
                    count++;

                    // 24-hour rule for approved bookings (non-past)
                    let canDeleteAfter24h = false;
                    if (status === "approved" && !pastStay && data.approvedDate) {
                        const approvedMs = new Date(data.approvedDate).getTime();
                        if (!isNaN(approvedMs)) {
                            canDeleteAfter24h = (Date.now() - approvedMs) >= (24 * 60 * 60 * 1000);
                        }
                    }

                    // Apply filters
                    const matchesStatus = statusFilter === 'all' || status === statusFilter;
                    const matchesSearch = data.fullName.toLowerCase().includes(searchQuery) || 
                                       data.email.toLowerCase().includes(searchQuery) ||
                                       data.selectedRoom.toLowerCase().includes(searchQuery);

                    if (matchesStatus && matchesSearch) {
                        filteredCount++;
                        const dpPaid = data.dpPaid === true;
                        table.innerHTML += `
                            <tr>
                                <td>${data.fullName}</td>
                                <td>${data.email}</td>
                                <td>${data.phoneNumber || data.phone || ''}</td>
                                <td>${data.selectedRoom}</td>
                                <td>${data.numberOfRooms}</td>
                                <td>${data.extraPax}</td>
                                <td>${data.checkInDate}</td>
                                <td>${data.checkOutDate}</td>
                                <td>${data.numberOfNights}</td>
                                <td>${data.totalAmount}</td>
                                <td style="color: #e74c3c; white-space:nowrap;">
                                    ${data.totalAmount ? '‚Ç±' + (parseFloat(data.totalAmount.replace(/[^0-9.-]+/g, '')) * 0.3).toLocaleString() : '‚Ç±0'}
                                    <input type="checkbox" class="dp-paid-checkbox" title="Mark as paid" style="margin-left:8px;vertical-align:middle;" data-id="${data.id}" ${dpPaid ? 'checked' : ''}>
                                </td>
                                <td style="color: #27ae60;">${data.totalAmount ? '‚Ç±' + (parseFloat(data.totalAmount.replace(/[^0-9.-]+/g, '')) * 0.7).toLocaleString() : '‚Ç±0'}</td>
                                <td id="status-${data.id}" style="font-weight:bold; color:${status === "approved" ? "green" : status === "rejected" ? "red" : "#FFC107"};">
                                    ${status}
                                </td>
                                <td id="actions-${data.id}">
                                    ${status === "pending" ? `
                                        <button class="confirm-btn" onclick="confirmBooking('${data.id}')">‚úî</button>
                                        <button class="reject-btn" onclick="rejectBooking('${data.id}')">‚úñ</button>
                                        ` : pastStay || status === "rejected" ? `
                                        ${pastStay ? `
                                        <span class="delete-icon" onclick="deleteBooking('${data.id}')">üóë</span>
                                        ` : `
                                        <button class="disabled-btn" disabled>${status === "approved" ? "‚úî Confirmed" : "‚úñ Rejected"}</button>
                                        <span class="delete-icon" onclick="deleteBooking('${data.id}')">üóë</span>
                                        `}
                                        ` : `
                                        <button class="disabled-btn" disabled>${status === "approved" ? "‚úî Confirmed" : "‚úñ Rejected"}</button>
                                        ${canDeleteAfter24h ? `<span class=\"delete-icon\" onclick=\"deleteBooking('${data.id}')\">üóë</span>` : ''}
                                    `}
                                </td>
                            </tr>`;
                // Attach event listeners for dp-paid-checkboxes (Firebase save)
                setTimeout(() => {
                    document.querySelectorAll('.dp-paid-checkbox[data-id]').forEach(checkbox => {
                        checkbox.addEventListener('change', function() {
                            const id = this.getAttribute('data-id');
                            const checked = this.checked;
                            update(ref(db, `bookings/${id}`), { dpPaid: checked });
                        });
                    });
                }, 0);
                    }
                });

                if (filteredCount === 0) {
                    table.innerHTML += `<tr><td colspan="13" style="text-align:center;">No bookings match the current filters</td></tr>`;
                }

                document.getElementById('reservationsCount').textContent = count;
            });
        }

        // Add event listeners for filters
        document.getElementById('statusFilter').addEventListener('change', loadBookings);
        document.getElementById('searchBar').addEventListener('input', loadBookings);

        // Initialize filters when loading reservations section
        document.querySelector('[data-section="reservations"]').addEventListener('click', () => {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('searchBar').value = '';
            loadBookings();
        });

        window.requestFeedback = (id, name, email) => {
            alert(`Email would be sent to ${name} (${email}) requesting feedback for their stay.`);
            // In a real system, this would trigger an email with a feedback link
        };
        
        function updateBookingStatus(id, status) { 
            update(ref(db, `bookings/${id}`), { status }).then(loadBookings); 
        }
        
        window.deleteBooking = (id) => { 
            if (confirm("Delete booking?")) remove(ref(db, `bookings/${id}`)).then(loadBookings); 
        };

       // Function to load announcements
function loadAnnouncements() {
    onValue(ref(db, 'announcements'), (snapshot) => {
        const announcementsList = document.getElementById("announcementsList");
        announcementsList.innerHTML = ""; // Clear existing list

        if (!snapshot.exists()) {
            announcementsList.innerHTML = "<p>No announcements yet.</p>";
            return;
        }

        const announcementsArray = [];
        snapshot.forEach(child => {
            announcementsArray.push({ id: child.key, ...child.val() });
        });

        // Sort announcements by date (newest first)
        announcementsArray.sort((a, b) => new Date(b.date) - new Date(a.date));

        announcementsArray.forEach(data => {
            announcementsList.innerHTML += `
                <div class="announcement-item">
                    <h3>${data.title}</h3>
                    <p>${data.content}</p>
                    <small>üìÖ ${formatDate(data.date)} | üìå ${data.category.replace("-", " ")}</small>
                    <div class="announcement-buttons">
                        <button class="edit-btn" onclick="editAnnouncement('${data.id}', '${data.title}', '${data.content}', '${data.category}')">‚úè Edit</button>
                        <button class="delete-btn" onclick="deleteAnnouncement('${data.id}')">üóë Delete</button>
                    </div>
                </div>
            `;
        });
    });
}

// Format date for display
function formatDate(dateString) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    return new Date(dateString).toLocaleDateString(undefined, options);
}

// Function to delete an announcement
window.deleteAnnouncement = (id) => {
    if (confirm("Are you sure you want to delete this announcement?")) {
                remove(ref(db, `announcements/${id}`))
            .then(() => alert("Announcement deleted successfully!"))
            .catch(error => alert("Error: " + error.message));
    }
};

// Function to edit an announcement
window.editAnnouncement = (id, title, content, category) => {
    document.getElementById("title").value = title;
    document.getElementById("content").value = content;
    document.getElementById("category").value = category;
    document.getElementById("submitBtn").innerText = "Update Announcement";
    document.getElementById("announcementForm").dataset.editingId = id;
};

// Handle form submission
document.getElementById("announcementForm").addEventListener("submit", (e) => {
    e.preventDefault();

    const title = document.getElementById("title").value.trim();
    const content = document.getElementById("content").value.trim();
    const category = document.getElementById("category").value;
    const today = new Date();
    const date = today.toLocaleDateString('en-CA'); // ‚úÖ Local date fix
    const editingId = document.getElementById("announcementForm").dataset.editingId;

    if (!title || !content) {
        alert("Please fill in all fields.");
        return;
    }

    if (editingId) {
        // Update existing announcement
                update(ref(db, `announcements/${editingId}`), { title, content, category, date })
            .then(() => {
                alert("Announcement updated successfully!");
                document.getElementById("announcementForm").reset();
                document.getElementById("submitBtn").innerText = "Post Announcement";
                delete document.getElementById("announcementForm").dataset.editingId;
                loadAnnouncements();
            })
            .catch(error => alert("Error: " + error.message));
    } else {
        // Add new announcement
        push(ref(db, "announcements"), { title, content, category, date })
            .then(() => {
                alert("Announcement posted successfully!");
                document.getElementById("announcementForm").reset();
                loadAnnouncements();
            })
            .catch(error => alert("Error: " + error.message));
    }
});

// Add the delete function
window.deleteFeedback = async function(feedbackId) {
    if (confirm("Are you sure you want to delete this feedback?")) {
        try {
                    await remove(ref(db, `feedback/${feedbackId}`));
            alert("Feedback deleted successfully!");
            loadFeedback();
        } catch (error) {
            console.error("Error deleting feedback:", error);
            alert("Failed to delete feedback. Please try again.");
        }
    }
};

function updateDashboardNotifications() {
    // Update reservation card notification
    onValue(ref(db, 'bookings'), (snapshot) => {
        let pendingCount = 0;
        let totalCount = 0;
        snapshot.forEach((child) => {
            const booking = child.val();
            totalCount++;
            if (booking.status === 'pending') {
                pendingCount++;
            }
        });
        
        const dashboardReservationNotification = document.getElementById('dashboard-reservation-notification');
        if (pendingCount > 0 || totalCount > 0) {
                    dashboardReservationNotification.textContent = `${pendingCount} new`;
        } else {
            dashboardReservationNotification.textContent = '';
        }
    });

    // Update feedback card notification
    onValue(ref(db, 'feedback'), (snapshot) => {
        let pendingCount = 0;
        let totalCount = 0;
        snapshot.forEach((child) => {
            const feedback = child.val();
            totalCount++;
            if (!feedback.isApproved && !feedback.isRejected) {
                pendingCount++;
            }
        });
        
        const dashboardFeedbackNotification = document.getElementById('dashboard-feedback-notification');
        if (pendingCount > 0 || totalCount > 0) {
                    dashboardFeedbackNotification.textContent = `${pendingCount} new`;
        } else {
            dashboardFeedbackNotification.textContent = '';
        }
    });
}

        // Initialize notifications
function initializeNotifications() {
    // Listen for new reservations
    const bookingsRef = ref(db, 'bookings');
    let lastReservationTime = Date.now();

    onValue(bookingsRef, (snapshot) => {
        if (!snapshot.exists()) return;

        let pendingCount = 0;
        snapshot.forEach((child) => {
            const booking = child.val();
            if (booking.status === 'pending') {
                pendingCount++;
            }
        });
        
        const reservationDot = document.getElementById('reservationDot');
        const reservationCount = document.getElementById('reservationCount');
                
            if (pendingCount > 0) {
                reservationDot.style.display = 'block';
                reservationCount.style.display = 'block';
                reservationCount.textContent = pendingCount;
            } else {
                reservationDot.style.display = 'none';
                reservationCount.style.display = 'none';
        }
    });

            // Listen for new feedback
    const feedbackRef = ref(db, 'feedback');
            let lastFeedbackTime = Date.now();

    onValue(feedbackRef, (snapshot) => {
                if (!snapshot.exists()) return;

        let pendingCount = 0;
        snapshot.forEach((child) => {
            const feedback = child.val();
            if (!feedback.isApproved && !feedback.isRejected) {
                pendingCount++;
            }
        });

        const feedbackDot = document.getElementById('feedbackDot');
        const feedbackCount = document.getElementById('feedbackCount');
                
            if (pendingCount > 0) {
                feedbackDot.style.display = 'block';
                feedbackCount.style.display = 'block';
                feedbackCount.textContent = pendingCount;
            } else {
                feedbackDot.style.display = 'none';
                feedbackCount.style.display = 'none';
        }
    });
}

        // Clear notification when section is clicked
document.querySelectorAll('.sidebar-item').forEach(item => {
    item.addEventListener('click', function() {
        document.querySelector('.dashboard-section').style.display = 'none';
        document.querySelector('.reservations-section').style.display = 'none';
        document.querySelector('.ratings-section').style.display = 'none';
        document.querySelector('.announcements-section').style.display = 'none';
        document.querySelector('.gallery-section').style.display = 'none';
        document.querySelector('.activities-section').style.display = 'none';
        
        document.querySelector(`.${this.dataset.section}-section`).style.display = 'block';

        document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
        if (this.classList.contains('sidebar-item')) this.classList.add('active');

        if (this.dataset.section === 'reservations') loadBookings();
        if (this.dataset.section === 'ratings') loadFeedback();
        if (this.dataset.section === 'announcements') loadAnnouncements();
        if (this.dataset.section === 'gallery') loadGalleryImages();
        if (this.dataset.section === 'activities') loadActivities();
    });
});

        // Initialize notifications on page load
        document.addEventListener('DOMContentLoaded', () => {
            initializeNotifications();
            
            // Check EmailJS status
            console.log("Page loaded, checking EmailJS...");
            if (typeof emailjs !== 'undefined') {
                console.log("EmailJS is available:", emailjs);
                console.log("EmailJS version:", emailjs.version);
            } else {
                console.error("EmailJS is not available");
            }
        });

// Add this function to update announcements count
function updateAnnouncementsCount() {
    onValue(ref(db, 'announcements'), (snapshot) => {
        let count = 0;
        snapshot.forEach(() => {
            count++;
        });
        
        const announcementsCount = document.getElementById('announcementsCount');
        if (announcementsCount) {
            announcementsCount.textContent = count;
        }
    });
}

// Add this to your existing DOMContentLoaded event listener
document.addEventListener('DOMContentLoaded', () => {
    updateAnnouncementsCount();
});

// Add test functions after the Firebase initialization
async function testFirebaseConnection() {
    try {
        // Test write operation
        const testRef = ref(db, "test");
        await push(testRef, {
            timestamp: new Date().toISOString(),
            test: "connection test"
        });
        console.log("Firebase write test successful");

        // Test read operation
        onValue(testRef, (snapshot) => {
            if (snapshot.exists()) {
                console.log("Firebase read test successful");
                console.log("Test data:", snapshot.val());
            }
        });

        // Test real-time updates
        const testListener = onValue(testRef, (snapshot) => {
            console.log("Real-time updates working");
        });

        // Clean up test data after 5 seconds
        setTimeout(() => {
            testListener(); // Remove the listener
            remove(testRef); // Remove the test data
        }, 5000);

    } catch (error) {
        console.error("Firebase test failed:", error);
        alert("Firebase connection test failed. Please check the console for details.");
    }
}

// Run the test when the page loads
document.addEventListener('DOMContentLoaded', () => {
    testFirebaseConnection();
});

        //
        // Compress image function
        function compressImage(dataUrl, targetSizeKB = 200) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Calculate new dimensions while maintaining aspect ratio
                    let width = img.width;
                    let height = img.height;
                    const maxSize = 800; // Maximum dimension in pixels
                    
                    if (width > height && width > maxSize) {
                        height = (height * maxSize) / width;
                        width = maxSize;
                    } else if (height > maxSize) {
                        width = (width * maxSize) / height;
                        height = maxSize;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Start with high quality
                    let quality = 0.9;
                    let compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    
                    // Reduce quality until file size is acceptable
                    while (compressedDataUrl.length > targetSizeKB * 1024 && quality > 0.1) {
                        quality -= 0.1;
                        compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    }
                    
                    resolve(compressedDataUrl);
                };
                img.src = dataUrl;
            });
        }

        // Load gallery images from Firebase
        function loadGalleryImages() {
            onValue(imagesRef, (snapshot) => {
                const galleryGrid = document.getElementById('galleryGrid');
                galleryGrid.innerHTML = '';
                
                if (snapshot.exists()) {
                    const images = snapshot.val();
                    let imageCount = 0;
                    // Sort entries by uploadedAt descending so newest show first
                    const sortedEntries = Object.entries(images).sort(([, a], [, b]) => {
                        const aTime = a && a.uploadedAt ? a.uploadedAt : 0;
                        const bTime = b && b.uploadedAt ? b.uploadedAt : 0;
                        return bTime - aTime;
                    });
                    sortedEntries.forEach(([key, image]) => {
                        imageCount++;
                        const uploadDate = new Date(image.uploadedAt || Date.now());
                        const galleryCard = document.createElement('div');
                        galleryCard.className = 'gallery-card';
                        galleryCard.dataset.uploadDate = uploadDate.toISOString();
                        galleryCard.innerHTML = `
                            <img src="${image.url}" alt="${image.name || 'Gallery image'}">
                            <div class="image-info">
                                <div class="image-title">${image.name || ''}</div>
                                ${image.description ? `<div class="image-description">${image.description}</div>` : ''}
                                <div class="upload-date">Uploaded: ${uploadDate.toLocaleDateString()}</div>
                            </div>
                            <div class="gallery-card-actions">
                                <button class="view-btn" onclick="window.open('${image.url}', '_blank')">View</button>
                                <button class="delete-btn" onclick="window.deleteImage('${key}')">Delete</button>
                            </div>
                        `;
                        galleryGrid.appendChild(galleryCard);
                    });
                    document.querySelector('.orange-card .card-number').textContent = imageCount;
                } else {
                    galleryGrid.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No images uploaded yet.</p>';
                    document.querySelector('.orange-card .card-number').textContent = '0';
                }
            });
        }

        // Delete image from Firebase
        window.deleteImage = async function(imageKey) {
            if (confirm('Are you sure you want to delete this image?')) {
                try {
                    // Delete from database
                    const imageRef = ref(db, `gallery/images/${imageKey}`);
                    await remove(imageRef);
                    
                    showStatus('Image deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting image:', error);
                    showStatus('Error deleting image. Please try again.', 'error');
                }
            }
        };

        // Show status message
        function showStatus(message, type) {
            const uploadStatus = document.getElementById('uploadStatus');
            uploadStatus.textContent = message;
            uploadStatus.className = `upload-status ${type}`;
            uploadStatus.style.display = 'block';
            
            setTimeout(() => {
                uploadStatus.style.display = 'none';
            }, 3000);
        }

        // File upload preview
        let selectedFiles = [];
        let compressedPreviews = [];
        
        document.getElementById('imageUpload').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files);
            selectedFiles = files;
            compressedPreviews = [];
            
            // Update selected files text
            const selectedFilesText = files.map(f => f.name).join(', ');
            document.getElementById('selectedFiles').textContent = `Selected: ${selectedFilesText}`;
            
            // Clear previous previews
            const previewSection = document.getElementById('previewSection');
            previewSection.innerHTML = '';
            
            // Create preview for each file
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                const readerPromise = new Promise((resolve) => {
                    reader.onload = async function(e) {
                        // Compress the image
                        const compressed = await compressImage(e.target.result);
                        compressedPreviews[i] = compressed;
                        
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.innerHTML = `
                            <img src="${compressed}" alt="Preview">
                            <div class="image-info">
                                <input type="text" placeholder="Enter image title" class="image-title" data-index="${i}">
                                <textarea placeholder="Enter image description" class="image-description" data-index="${i}"></textarea>
                            </div>
                            <button class="remove-btn" onclick="window.removePreview(${i})">Remove</button>
                        `;
                        previewSection.appendChild(previewItem);
                        resolve();
                    };
                    reader.readAsDataURL(file);
                });
                
                await readerPromise;
            }
            
            // Enable upload button
            document.getElementById('uploadBtn').disabled = files.length === 0;
        });

        // Remove preview
        window.removePreview = function(index) {
            selectedFiles.splice(index, 1);
            compressedPreviews.splice(index, 1);
            document.getElementById('imageUpload').value = '';
            refreshPreviews();
        };

        // Refresh previews
        async function refreshPreviews() {
            const previewSection = document.getElementById('previewSection');
            previewSection.innerHTML = '';
            
            for (let i = 0; i < selectedFiles.length; i++) {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                previewItem.innerHTML = `
                    <img src="${compressedPreviews[i]}" alt="Preview">
                    <button class="remove-btn" onclick="window.removePreview(${i})">Remove</button>
                `;
                previewSection.appendChild(previewItem);
            }
            
            document.getElementById('uploadBtn').disabled = selectedFiles.length === 0;
            document.getElementById('selectedFiles').textContent = selectedFiles.length > 0 
                ? `Selected: ${selectedFiles.map(f => f.name).join(', ')}`
                : '';
        }

        // Upload form submission
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (selectedFiles.length === 0) return;
            
            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = true;
            showStatus('Uploading images...', 'success');
            
            try {
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    const compressedDataUrl = compressedPreviews[i];
                    
                    // Get title and description for this image
                    const titleInput = document.querySelector(`.image-title[data-index="${i}"]`);
                    const descriptionInput = document.querySelector(`.image-description[data-index="${i}"]`);
                    const title = titleInput ? titleInput.value.trim() : '';
                    const description = descriptionInput ? descriptionInput.value.trim() : '';
                    
                    // Save to database with title and description
                    const newImageRef = push(imagesRef);
                    await set(newImageRef, {
                        url: compressedDataUrl,
                        name: title || file.name,
                        description: description,
                        uploadedAt: Date.now()
                    });
                }
                
                // Clear upload form
                document.getElementById('imageUpload').value = '';
                document.getElementById('previewSection').innerHTML = '';
                document.getElementById('selectedFiles').textContent = '';
                uploadBtn.disabled = true;
                selectedFiles = [];
                compressedPreviews = [];
                
                showStatus('Images uploaded successfully!', 'success');
            } catch (error) {
                console.error('Error uploading images:', error);
                showStatus('Error uploading images. Please try again.', 'error');
                uploadBtn.disabled = false;
            }
        });

        // Load gallery images on page load
        loadGalleryImages();

        // Add new functions for logging
        function addLogEntry(action, details) {
            const logRef = ref(db, 'activityLog');
            const newLogEntry = {
                action: action,
                details: details,
                timestamp: new Date().toISOString(),
                adminId: 'admin' // You can replace this with actual admin ID
            };
            push(logRef, newLogEntry);
        }

        function loadLogs() {
            const logRef = ref(db, 'activityLog');
            const logEntries = document.getElementById('logEntries');
            
            onValue(logRef, (snapshot) => {
                logEntries.innerHTML = '';
                const entries = [];
                
                snapshot.forEach((child) => {
                    entries.push({ id: child.key, ...child.val() });
                });
                
                // Sort entries by timestamp (newest first)
                entries.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                entries.forEach((entry) => {
                    const entryDiv = document.createElement('div');
                    entryDiv.className = 'log-entry';
                    entryDiv.innerHTML = `
                        <div class="timestamp">${new Date(entry.timestamp).toLocaleString()}</div>
                        <div class="action">${entry.action}</div>
                        <div class="details">${entry.details}</div>
                    `;
                    logEntries.appendChild(entryDiv);
                });
            });
        }

        // Add logging to existing functions
        window.handleLogout = function() {
            addLogEntry('Admin Logout', 'Admin logged out of the system');
            sessionStorage.removeItem('isLoggedIn');
            var dashboardContent = document.getElementById('dashboardContent');
            var loginModal = document.getElementById('loginModal');
            var loginForm = document.getElementById('loginForm');
            var loginError = document.getElementById('loginError');
            dashboardContent.classList.remove('visible');
            setTimeout(function() {
                dashboardContent.style.display = 'none';
                loginModal.style.display = 'flex';
                // Reset login form fields and error
                if (loginForm) {
                    loginForm.reset();
                }
                if (loginError) {
                    loginError.style.display = 'none';
                }
            }, 400);
        };

        // Add activities loading function
        function loadActivities() {
            const activitiesRef = ref(db, "activities");
            const table = document.getElementById("activitiesTable");
            const activityFilter = document.getElementById("activityFilter").value;
            const statusFilter = document.getElementById("activityStatusFilter").value;
            const searchQuery = document.getElementById("activitySearchBar").value.toLowerCase();

            onValue(activitiesRef, (snapshot) => {
                // Create a map to track cottage bookings
                const cottageBookings = new Map(); // date -> Set of booked cottages

                // First pass: collect all cottage bookings
                snapshot.forEach((child) => {
                    const data = child.val();
                    if (data.activityType === 'swimming' && data.cottage && data.status !== 'rejected') {
                        const dateKey = data.date;
                        if (!cottageBookings.has(dateKey)) {
                            cottageBookings.set(dateKey, new Set());
                        }
                        cottageBookings.get(dateKey).add(data.cottage);
                    }
                });

                // Reset table headers
                table.innerHTML = `
                    <tr>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>Activity Type</th>
                        <th>Date</th>
                        <th>Details</th>
                        <th>Total Amount</th>
                        <th>Down Payment</th>
                        <th>Balance</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>`;

                if (!snapshot.exists()) {
                    table.innerHTML += `<tr><td colspan="10" style="text-align:center;">No activity reservations</td></tr>`;
                    return;
                }

                let count = 0;
                let pendingCount = 0;
                let activitiesArray = [];

                snapshot.forEach((child) => {
                    const data = child.val();
                    data.id = child.key;
                    activitiesArray.push(data);
                });

                // Sort activities by date in descending order
                activitiesArray.sort((a, b) => {
                    const tsA = a.createdAt || (a.activityType === 'swimming'
                        ? new Date(a.date || a.swimmingDate || 0).getTime()
                        : new Date(a.checkOut || a.checkOutDate || a.checkIn || a.checkInDate || 0).getTime());
                    const tsB = b.createdAt || (b.activityType === 'swimming'
                        ? new Date(b.date || b.swimmingDate || 0).getTime()
                        : new Date(b.checkOut || b.checkOutDate || b.checkIn || b.checkInDate || 0).getTime());
                    return tsB - tsA;
                });

                activitiesArray.forEach((data) => {
                    let status = data.status || "pending";
                    count++;

                    if (status === "pending") {
                        pendingCount++;
                    }

                    // Get activity date based on activity type
                    let activityDate;
                    if (data.activityType === 'swimming') {
                        activityDate = new Date(data.date || data.swimmingDate || '');
                    } else if (data.activityType === 'tent') {
                        activityDate = new Date(data.checkOut || data.checkOutDate);
                    }

                    // 24-hour rule for approved activities
                    let canDeleteActivityAfter24h = false;
                    if (status === 'approved' && data.approvedDate) {
                        const approvedMs = new Date(data.approvedDate).getTime();
                        if (!isNaN(approvedMs)) {
                            canDeleteActivityAfter24h = (Date.now() - approvedMs) >= (24 * 60 * 60 * 1000);
                        }
                    }

                    // Format details based on activity type with fallbacks
                    // Fallbacks to support older submissions
                    const nameDisplay = (data.fullName || data.name || data.cottageName || data.swimmingName || '').toString();
                    const emailDisplay = (data.email || data.cottageEmail || data.swimmingEmail || '').toString();
                    const cottageVal = (data.cottage || data.cottageNumber || '').toString();

                  
                  
                    let details = '';
                    if (data.activityType === 'swimming') {
                        // For swimming pool: show only cottage number
                        details = cottageVal ? `Cottage: ${cottageVal}` : 'No cottage assigned';
                    } else if (data.activityType === 'tent') {
                        // For tent camping: show number of persons, additional guests, and tent type
                        const guestsVal = (data.guests || data.numberOfPerson || 0);
                        const addGuestsVal = (data.additionalGuest || data.additionalGuests || 0);
                        const tentType = (data.hasTent === 'yes' || data.rented === false) ? 'Own Tent' : 'Rented Tent';
                        details = `Persons: ${guestsVal}${addGuestsVal ? `, Additional: ${addGuestsVal}` : ''}, ${tentType}`;
                    }

                    // Derive display amounts with fallbacks and on-the-fly computation when needed
                    const totalText = (data.totalAmount || data.swimmingTotalAmount || data.cottageTotalAmount || '‚Ç±0').toString();
                    const parsePeso = (txt) => Number(String(txt).replace(/[^0-9.-]+/g, '')) || 0;
                    const totalNum = parsePeso(totalText);
                    const downText = (data.downPayment || (totalNum ? `‚Ç±${Math.round(totalNum * 0.3).toLocaleString()}` : '‚Ç±0')).toString();
                    const balanceText = (data.balanceAmount || (totalNum ? `‚Ç±${(totalNum - Math.round(totalNum * 0.3)).toLocaleString()}` : '‚Ç±0')).toString();

                    // Format date display based on activity type with fallback
                    let dateDisplay;
                    if (data.activityType === 'swimming') {
                        dateDisplay = (data.date || data.swimmingDate || '');
                    } else {
                        const inDate = (data.checkIn || data.checkInDate || '').toString();
                        const outDate = (data.checkOut || data.checkOutDate || '').toString();
                        if (inDate && outDate) {
                            dateDisplay = `${inDate} to ${outDate}`;
                        } else if (inDate || outDate) {
                            dateDisplay = inDate || outDate;
                        } else {
                            dateDisplay = '-';
                        }
                    }

                    // Apply filters
                    const matchesActivity = activityFilter === 'all' || data.activityType === activityFilter;
                    const matchesStatus = statusFilter === 'all' || status === statusFilter;
                    const matchesSearch = (nameDisplay || '').toLowerCase().includes(searchQuery) || 
                                       (emailDisplay || '').toLowerCase().includes(searchQuery);

                    if (matchesActivity && matchesStatus && matchesSearch) {
                        const dpPaid = data.dpPaid === true;
                        let statusColor = '#FFC107';
                        if (status === 'approved') statusColor = 'green';
                        if (status === 'rejected') statusColor = 'red';
                        let statusText = status.charAt(0).toUpperCase() + status.slice(1);
                        // Add peso sign for swimming pool only
                        const pesoTotal = data.activityType === 'swimming' ? `‚Ç±${totalText.replace(/[^\d.]/g, '')}` : totalText || '‚Ç±0';
                        const pesoDown = data.activityType === 'swimming' ? `‚Ç±${downText.replace(/[^\d.]/g, '')}` : downText || '‚Ç±0';
                        const pesoBalance = data.activityType === 'swimming' ? `‚Ç±${balanceText.replace(/[^\d.]/g, '')}` : balanceText || '‚Ç±0';
                        table.innerHTML += `
                            <tr>
                                <td>${nameDisplay}</td>
                                <td>${emailDisplay}</td>
                                <td>${data.phoneNumber || data.phone || data.guestPhone || data.contactNumber || data.mobile || ''}</td>
                                <td>${data.activityType === 'swimming' ? 'Swimming Pool' : 'Tent Camping'}</td>
                                <td>${dateDisplay}</td>
                                <td>${details}</td>
                                <td>${pesoTotal}</td>
                                <td style="color: #e74c3c; font-weight: bold; white-space:nowrap;">
                                    ${pesoDown}
                                    <input type="checkbox" class="dp-paid-checkbox" title="Mark as paid" style="margin-left:8px;vertical-align:middle;" data-id="${data.id}" ${dpPaid ? 'checked' : ''}>
                                </td>
                                <td style="color: #27ae60; font-weight: bold;">${pesoBalance}</td>
                                <td style="font-weight:bold; color:${statusColor};">${statusText}</td>
                                <td>
                                    ${status === "pending" ? `
                                        <button class="confirm-btn" onclick="confirmActivity('${data.id}')">‚úî</button>
                                        <button class="reject-btn" onclick="rejectActivity('${data.id}')">‚úñ</button>
                                    ` : `
                                        <button class="disabled-btn" disabled>${status === "approved" ? "‚úî Confirmed" : "‚úñ Rejected"}</button>
                                        ${status === 'rejected' || canDeleteActivityAfter24h ? `<span class=\"delete-icon\" onclick=\"deleteActivity('${data.id}')\">üóë</span>` : ''}
                                    `}
                                </td>
                            </tr>`;
                    }
                // Attach event listeners for dp-paid-checkboxes in activities (Firebase save)
                setTimeout(() => {
                    document.querySelectorAll('.dp-paid-checkbox[data-id]').forEach(checkbox => {
                        checkbox.addEventListener('change', function() {
                            const id = this.getAttribute('data-id');
                            const checked = this.checked;
                            update(ref(db, `activities/${id}`), { dpPaid: checked });
                        });
                    });
                }, 0);
                });

                // Update notification count
                document.getElementById('activitiesCardCount').textContent = count;
                document.getElementById('activitiesCount').textContent = pendingCount;
                document.getElementById('activitiesDot').style.display = pendingCount > 0 ? 'block' : 'none';
                document.getElementById('activitiesCount').style.display = pendingCount > 0 ? 'block' : 'none';

                // If no results after filtering, show message
                if (table.rows.length === 1) { // Only header row exists
                    table.innerHTML += `<tr><td colspan="10" style="text-align:center;">No activities match the current filters</td></tr>`;
                }
            });
        }

        // Initialize activities section
        loadActivities();

        // Activity management functions
        window.confirmActivity = async function(id) {
            try {
                const activityRef = ref(db, `activities/${id}`);
                const snapshot = await get(activityRef);
                const activity = snapshot.val();

                if (activity.activityType === 'swimming' && activity.cottage) {
                    const isAvailable = await checkCottageAvailability(activity.date, activity.cottage);
                    if (!isAvailable) {
                        const availableCottages = await getAvailableCottages(activity.date);
                        const availableOptions = Object.entries(availableCottages)
                            .filter(([_, available]) => available)
                            .map(([number, _]) => number);

                        if (availableOptions.length > 0) {
                            alert(`Cottage ${activity.cottage} is already booked for this date.\nAvailable cottages: ${availableOptions.join(', ')}`);
                        } else {
                            alert(`No cottages available for this date. Please choose a different date.`);
                        }
                        return;
                    }
                }

                await update(ref(db, `activities/${id}`), {
                    status: "approved",
                    approvedDate: new Date().toISOString()
                });
                
                // Send confirmation email
                try {
                    await sendBookingEmail(activity, "confirmed", "activity");
                } catch (emailError) {
                    console.error("Email failed but activity was confirmed:", emailError);
                    alert("Activity reservation confirmed successfully! (Email notification failed)");
                }
                
                // Check if there are any remaining pending activities
                const activitiesRef = ref(db, 'activities');
                const activitiesSnapshot = await get(activitiesRef);
                let hasPending = false;
                activitiesSnapshot.forEach((child) => {
                    const activity = child.val();
                    if (activity.status === 'pending') {
                        hasPending = true;
                    }
                });
                
                // Only hide notification if no pending activities remain
                if (!hasPending) {
                    const activitiesDot = document.getElementById('activitiesDot');
                    const activitiesCount = document.getElementById('activitiesCount');
                    if (activitiesDot) activitiesDot.style.display = 'none';
                    if (activitiesCount) activitiesCount.style.display = 'none';
                }
                
                loadActivities();
            } catch (error) {
                console.error("Error confirming activity:", error);
                alert("Failed to confirm activity. Please try again.");
            }
        };

        window.rejectActivity = async function(id) {
            try {
                // First get the activity data to send email
                const activityRef = ref(db, `activities/${id}`);
                const activitySnapshot = await get(activityRef);
                const activityData = activitySnapshot.val();
                
                await update(ref(db, `activities/${id}`), {
                    status: "rejected",
                    rejectedDate: new Date().toISOString()
                });
                
                // Send rejection email
                try {
                    await sendBookingEmail(activityData, "rejected", "activity");
                } catch (emailError) {
                    console.error("Email failed but activity was rejected:", emailError);
                    alert("Activity reservation rejected successfully! (Email notification failed)");
                }
                
                loadActivities();
            } catch (error) {
                console.error("Error rejecting activity:", error);
                alert("Failed to reject activity. Please try again.");
            }
        };

        window.deleteActivity = async function(id) {
            if (confirm("Are you sure you want to delete this activity reservation?")) {
                try {
                    await remove(ref(db, `activities/${id}`));
                    alert("Activity reservation deleted successfully!");
                    loadActivities();
                } catch (error) {
                    console.error("Error deleting activity:", error);
                    alert("Failed to delete activity. Please try again.");
                }
            }
        };

        // Add event listeners for activity filters
        document.getElementById('activityFilter').addEventListener('change', loadActivities);
        document.getElementById('activityStatusFilter').addEventListener('change', loadActivities);
        document.getElementById('activitySearchBar').addEventListener('input', loadActivities);

        // Update section display logic
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelector('.dashboard-section').style.display = 'none';
                document.querySelector('.reservations-section').style.display = 'none';
                document.querySelector('.ratings-section').style.display = 'none';
                document.querySelector('.announcements-section').style.display = 'none';
                document.querySelector('.gallery-section').style.display = 'none';
                document.querySelector('.activities-section').style.display = 'none';
                
                document.querySelector(`.${this.dataset.section}-section`).style.display = 'block';

                document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
                if (this.classList.contains('sidebar-item')) this.classList.add('active');

                if (this.dataset.section === 'reservations') loadBookings();
                if (this.dataset.section === 'ratings') loadFeedback();
                if (this.dataset.section === 'announcements') loadAnnouncements();
                if (this.dataset.section === 'gallery') loadGalleryImages();
                if (this.dataset.section === 'activities') loadActivities();
            });
        });

        // Update activities count in dashboard card
        onValue(ref(db, 'activities'), (snapshot) => {
            let totalActivities = 0;
            snapshot.forEach(() => {
                totalActivities++;
            });
            document.getElementById('activitiesCardCount').textContent = totalActivities;
});

        // Add function to check cottage availability
        window.checkCottageAvailability = async function(date, cottageNumber) {
            const activitiesRef = ref(db, "activities");
            let isAvailable = true;
            
            try {
                const snapshot = await get(activitiesRef);
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        const booking = child.val();
                        if (booking.activityType === 'swimming' && 
                            booking.date === date && 
                            booking.cottage === cottageNumber &&
                            booking.status !== 'rejected') {
                            isAvailable = false;
                        }
                    });
                }
            } catch (error) {
                console.error("Error checking cottage availability:", error);
            }
            
            return isAvailable;
        };

        // Add function to get available cottages for a date
        window.getAvailableCottages = async function(date) {
            const cottages = {
                '1': true,  // Cottage 1 (‚Ç±300)
                '2': true,  // Cottage 2 (‚Ç±300)
                '3': true,  // Cottage 3 (‚Ç±300)
                '4': true   // Big Cottage (‚Ç±500)
            };
            
            const activitiesRef = ref(db, "activities");
            
            try {
                const snapshot = await get(activitiesRef);
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        const booking = child.val();
                        if (booking.activityType === 'swimming' && 
                            booking.date === date &&
                            booking.status !== 'rejected') {
                            cottages[booking.cottage] = false;
                        }
                    });
                }
            } catch (error) {
                console.error("Error getting available cottages:", error);
            }
            
            return cottages;
        };

        // Add these new functions for gallery filtering
        function filterGalleryByMonth() {
            const monthFilter = document.getElementById('galleryMonthFilter').value;
            const cards = document.querySelectorAll('.gallery-card');
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();

            cards.forEach(card => {
                const uploadDate = new Date(card.dataset.uploadDate);
                let show = true;

                switch(monthFilter) {
                    case 'current':
                        show = uploadDate.getMonth() === currentMonth && 
                               uploadDate.getFullYear() === currentYear;
                        break;
                    case 'last':
                        const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
                        const lastYear = currentMonth === 0 ? currentYear - 1 : currentYear;
                        show = uploadDate.getMonth() === lastMonth && 
                               uploadDate.getFullYear() === lastYear;
                        break;
                    case 'older':
                        const oneMonthAgo = new Date(currentYear, currentMonth - 1, 1);
                        show = uploadDate < oneMonthAgo;
                        break;
                }

                card.style.display = show ? 'block' : 'none';
            });
            
        }

        function filterGalleryBySearch() {
            const searchQuery = document.getElementById('gallerySearch').value.toLowerCase();
            const cards = document.querySelectorAll('.gallery-card');

            cards.forEach(card => {
                const title = card.querySelector('.image-title').textContent.toLowerCase();
                const description = card.querySelector('.image-description')?.textContent.toLowerCase() || '';
                const matches = title.includes(searchQuery) || description.includes(searchQuery);
                card.style.display = matches ? 'block' : 'none';
            });
        }

        // Expose gallery filter functions for inline handlers
        window.filterGalleryByMonth = filterGalleryByMonth;
        window.filterGalleryBySearch = filterGalleryBySearch;
    </script>

        </div>
<script>
// Simple login logic for demo (username: admin, password: admin123)
document.addEventListener('DOMContentLoaded', function() {
    var loginModal = document.getElementById('loginModal');
    var loginForm = document.getElementById('loginForm');
    var loginUser = document.getElementById('loginUser');
    var loginPass = document.getElementById('loginPass');
    var loginError = document.getElementById('loginError');
    var dashboardContent = document.getElementById('dashboardContent');
    function showDashboard() {
        loginModal.style.display = 'none';
        dashboardContent.style.display = '';
        // Smooth fade-in
        setTimeout(function() {
            dashboardContent.classList.add('visible');
        }, 10);
    }
    // Always hide dashboard content by default
    dashboardContent.style.display = 'none';
    dashboardContent.classList.remove('visible');
    // Check if already logged in (sessionStorage)
    if (sessionStorage.getItem('isLoggedIn') === 'true') {
    showDashboard();
    } else {
        loginModal.style.display = 'flex';
    }
    loginForm.onsubmit = function(e) {
        e.preventDefault();
        if (loginUser.value === 'nameknotfound' && loginPass.value === 'friedchicken11') {
            sessionStorage.setItem('isLoggedIn', 'true');
            showDashboard();
        } else {
            loginError.style.display = 'block';
        }
    };
    // Bubbles animation
    var bubblesBg = document.querySelector('.bubbles-bg');
    if (bubblesBg) {
        for (let i = 0; i < 18; i++) {
            let bubble = document.createElement('div');
            bubble.className = 'bubble';
            let size = Math.random() * 48 + 32;
            bubble.style.width = size + 'px';
            bubble.style.height = size + 'px';
            bubble.style.left = (Math.random() * 100) + 'vw';
            bubble.style.animationDuration = (6 + Math.random() * 5) + 's';
            bubble.style.animationDelay = (Math.random() * 6) + 's';
            bubble.style.background = `linear-gradient(120deg, rgba(168,237,234,${0.5+Math.random()*0.3}) 0%, rgba(254,214,227,${0.5+Math.random()*0.3}) 100%)`;
            bubblesBg.appendChild(bubble);
        }
    }
});
</script>
<script>
    // Prevent dashboard access without login and add bubbles
document.addEventListener('DOMContentLoaded', function() {
    var dashboardContent = document.getElementById('dashboardContent');
    var loginModal = document.getElementById('loginModal');
    if (!sessionStorage.getItem('isLoggedIn')) {
        dashboardContent.style.display = 'none';
        loginModal.style.display = 'flex';
    } else {
        dashboardContent.style.display = '';
        loginModal.style.display = 'none';
    }
    // Bubbles animation
    var bubblesBg = document.querySelector('.bubbles-bg');
    if (bubblesBg) {
        for (let i = 0; i < 18; i++) {
            let bubble = document.createElement('div');
            bubble.className = 'bubble';
            let size = Math.random() * 48 + 32;
            bubble.style.width = size + 'px';
            bubble.style.height = size + 'px';
            bubble.style.left = (Math.random() * 100) + 'vw';
            bubble.style.animationDuration = (6 + Math.random() * 5) + 's';
            bubble.style.animationDelay = (Math.random() * 6) + 's';
            bubble.style.background = `linear-gradient(120deg, rgba(168,237,234,${0.5+Math.random()*0.3}) 0%, rgba(254,214,227,${0.5+Math.random()*0.3}) 100%)`;
            bubblesBg.appendChild(bubble);
        }
    }
});
// Handle logout to show login modal again
function handleLogout() {
    sessionStorage.removeItem('isLoggedIn');
    var dashboardContent = document.getElementById('dashboardContent');
    var loginModal = document.getElementById('loginModal');
    var loginForm = document.getElementById('loginForm');
    var loginError = document.getElementById('loginError');
    dashboardContent.classList.remove('visible');
    setTimeout(function() {
        dashboardContent.style.display = 'none';
        loginModal.style.display = 'flex';
        // Reset login form fields and error
        if (loginForm) {
            loginForm.reset();
        }
        if (loginError) {
            loginError.style.display = 'none';
        }
    }, 400);
}
</script>
</body>
</html>